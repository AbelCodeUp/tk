var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,g){b!=Array.prototype&&b!=Object.prototype&&(b[a]=g.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var b=0;return function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+b++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var a=0;return $jscomp.iteratorPrototype(function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,a){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var g=0,f={next:function(){if(g<b.length){var c=g++;return{value:a(c,b[c]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};
$jscomp.polyfill=function(b,a,g,f){if(a){g=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var c=b[f];c in g||(g[c]={});g=g[c]}b=b[b.length-1];f=g[b];a=a(f);a!=f&&null!=a&&$jscomp.defineProperty(g,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
(function(){var b=!1;try{b=window.__SDKDEV__}catch(g){b=!1}if(!b){b=decodeURIComponent(window.location.href);var a=b.indexOf("?");b=b.substring(a+1).match(/(^|&)debug=([^&]*)(&|$)/i);b=null!=b?b[2]:""}window.localStorage&&window.localStorage.setItem("debug",b?"*":"none")})();
!function(b,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?exports.io=a():b.io=a()}(this,function(){return function(b){function a(f){if(g[f])return g[f].exports;var c=g[f]={exports:{},id:f,loaded:!1};return b[f].call(c.exports,c,c.exports,a),c.loaded=!0,c.exports}var g={};return a.m=b,a.c=g,a.p="",a(0)}([function(b,a,g){function f(a,b){"object"===("undefined"==typeof a?"undefined":c(a))&&(b=a,a=void 0);
b=b||{};var h;a=e(a);var r=a.source,t=a.id,f=a.path;f=n[t]&&f in n[t].nsps;return b.forceNew||b["force new connection"]||!1===b.multiplex||f?(l("ignoring socket cache for %s",r),h=d(r,b)):(n[t]||(l("new io instance for %s",r),n[t]=d(r,b)),h=n[t]),a.query&&!b.query&&(b.query=a.query),h.socket(a.path,b)}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":
typeof a},e=g(1),k=g(7),d=g(13),l=g(3)("socket.io-client");b.exports=a=f;var n=a.managers={};a.protocol=k.protocol;a.connect=f;a.Manager=g(13);a.Socket=g(39)},function(b,a,g){(function(a){var c=g(2),e=g(3)("socket.io-client:url");b.exports=function(b,d){var f=b;d=d||a.location;null==b&&(b=d.protocol+"//"+d.host);"string"==typeof b&&("/"===b.charAt(0)&&(b="/"===b.charAt(1)?d.protocol+b:d.host+b),/^(https?|wss?):\/\//.test(b)||(e("protocol-less url %s",b),b="undefined"!=typeof d?d.protocol+"//"+b:"https://"+
b),e("parse %s",b),f=c(b));f.port||(/^(http|ws)$/.test(f.protocol)?f.port="80":/^(http|ws)s$/.test(f.protocol)&&(f.port="443"));f.path=f.path||"/";b=-1!==f.host.indexOf(":")?"["+f.host+"]":f.host;return f.id=f.protocol+"://"+b+":"+f.port,f.href=f.protocol+"://"+b+(d&&d.port===f.port?"":":"+f.port),f}}).call(a,function(){return this}())},function(b,a){var g=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
f="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");b.exports=function(a){var c=a,b=a.indexOf("["),d=a.indexOf("]");-1!=b&&-1!=d&&(a=a.substring(0,b)+a.substring(b,d).replace(/:/g,";")+a.substring(d,a.length));a=g.exec(a||"");for(var l={},n=14;n--;)l[f[n]]=a[n]||"";return-1!=b&&-1!=d&&(l.source=c,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=
!0),l}},function(b,a,g){(function(f){function c(){try{var c=a.storage.debug}catch(l){}return!c&&"undefined"!=typeof f&&"env"in f&&(c=f.env.DEBUG),c}a=b.exports=g(5);a.log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)};a.formatArgs=function(c){var b=this.useColors;if(c[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+c[0]+(b?"%c ":" ")+"+"+a.humanize(this.diff),b){b="color: "+this.color;c.splice(1,0,b,"color: inherit");var d=0,e=0;c[0].replace(/%[a-zA-Z%]/g,
function(a){"%%"!==a&&(d++,"%c"===a&&(e=d))});c.splice(e,0,b)}};a.save=function(c){try{null==c?a.storage.removeItem("debug"):a.storage.debug=c}catch(l){}};a.load=c;a.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&
window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var e=a;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var k=chrome.storage.local;else a:{try{k=window.localStorage;break a}catch(d){}k=void 0}e.storage=k;a.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");
a.formatters.j=function(a){try{return JSON.stringify(a)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}};a.enable(c())}).call(a,g(4))},function(b,a){function g(){throw Error("setTimeout has not been defined");}function f(){throw Error("clearTimeout has not been defined");}function c(a){if(m===setTimeout)return setTimeout(a,0);if((m===g||!m)&&setTimeout)return m=setTimeout,setTimeout(a,0);try{return m(a,0)}catch(u){try{return m.call(null,a,0)}catch(z){return m.call(this,a,0)}}}function e(a){if(h===
clearTimeout)return clearTimeout(a);if((h===f||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(a);try{return h(a)}catch(u){try{return h.call(null,a)}catch(z){return h.call(this,a)}}}function k(){t&&q&&(t=!1,q.length?r=q.concat(r):w=-1,r.length&&d())}function d(){if(!t){var a=c(k);t=!0;for(var b=r.length;b;){q=r;for(r=[];++w<b;)q&&q[w].run();w=-1;b=r.length}q=null;t=!1;e(a)}}function l(a,c){this.fun=a;this.array=c}function n(){}b=b.exports={};try{var m="function"==typeof setTimeout?setTimeout:
g}catch(I){m=g}try{var h="function"==typeof clearTimeout?clearTimeout:f}catch(I){h=f}!0;var q,r=[],t=!1,w=-1;b.nextTick=function(a){var b=Array(arguments.length-1);if(1<arguments.length)for(var e=1;e<arguments.length;e++)b[e-1]=arguments[e];r.push(new l(a,b));1!==r.length||t||c(d)};l.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=n;b.addListener=n;b.once=n;b.off=n;b.removeListener=n;b.removeAllListeners=n;
b.emit=n;b.prependListener=n;b.prependOnceListener=n;b.listeners=function(a){return[]};b.binding=function(a){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(a){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},function(b,a,g){function f(c){var b,e=0;for(b in c)e=(e<<5)-e+c.charCodeAt(b),e|=0;return a.colors[Math.abs(e)%a.colors.length]}function c(c){function b(){if(b.enabled){var c=+new Date;b.diff=c-(e||c);b.prev=e;e=b.curr=
c;var d=Array(arguments.length);for(c=0;c<d.length;c++)d[c]=arguments[c];d[0]=a.coerce(d[0]);"string"!=typeof d[0]&&d.unshift("%O");var f=0;d[0]=d[0].replace(/%([a-zA-Z%])/g,function(c,e){if("%%"===c)return c;f++;e=a.formatters[e];"function"==typeof e&&(c=e.call(b,d[f]),d.splice(f,1),f--);return c});a.formatArgs.call(b,d);(b.log||a.log||console.log.bind(console)).apply(b,d)}}return b.namespace=c,b.enabled=a.enabled(c),b.useColors=a.useColors(),b.color=f(c),"function"==typeof a.init&&a.init(b),b}a=
b.exports=c.debug=c["default"]=c;a.coerce=function(a){return a instanceof Error?a.stack||a.message:a};a.disable=function(){a.enable("")};a.enable=function(c){a.save(c);a.names=[];a.skips=[];for(var b=("string"==typeof c?c:"").split(/[\s,]+/),e=b.length,f=0;f<e;f++)b[f]&&(c=b[f].replace(/\*/g,".*?"),"-"===c[0]?a.skips.push(new RegExp("^"+c.substr(1)+"$")):a.names.push(new RegExp("^"+c+"$")))};a.enabled=function(c){var b;var e=0;for(b=a.skips.length;e<b;e++)if(a.skips[e].test(c))return!1;e=0;for(b=
a.names.length;e<b;e++)if(a.names[e].test(c))return!0;return!1};a.humanize=g(6);a.names=[];a.skips=[];a.formatters={};var e},function(b,a){function g(a){if(a=String(a),!(100<a.length))if(a=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a)){var b=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return b*l;case "days":case "day":case "d":return b*d;case "hours":case "hour":case "hrs":case "hr":case "h":return b*
k;case "minutes":case "minute":case "mins":case "min":case "m":return b*e;case "seconds":case "second":case "secs":case "sec":case "s":return b*c;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return b}}}function f(a,c,b){if(!(a<c))return a<1.5*c?Math.floor(a/c)+" "+b:Math.ceil(a/c)+" "+b+"s"}var c=1E3,e=60*c,k=60*e,d=24*k,l=365.25*d;b.exports=function(a,b){b=b||{};var h=typeof a;if("string"===h&&0<a.length)return g(a);if("number"===h&&!1===isNaN(a))return b["long"]?f(a,
d,"day")||f(a,k,"hour")||f(a,e,"minute")||f(a,c,"second")||a+" ms":a>=d?Math.round(a/d)+"d":a>=k?Math.round(a/k)+"h":a>=e?Math.round(a/e)+"m":a>=c?Math.round(a/c)+"s":a+"ms";throw Error("val is not a non-empty string or a valid number. val\x3d"+JSON.stringify(a));}},function(b,a,g){function f(){}function c(c){var b=""+c.type;return a.BINARY_EVENT!==c.type&&a.BINARY_ACK!==c.type||(b+=c.attachments+"-"),c.nsp&&"/"!==c.nsp&&(b+=c.nsp+","),null!=c.id&&(b+=c.id),null!=c.data&&(b+=JSON.stringify(c.data)),
n("encoded %j as %s",c,b),b}function e(a,b){h.removeBlobs(a,function(a){var d=h.deconstructPacket(a);a=c(d.packet);d=d.buffers;d.unshift(a);b(d)})}function k(){this.reconstructor=null}function d(a){this.reconPack=a;this.buffers=[]}function l(){return{type:a.ERROR,data:"parser error"}}var n=g(3)("socket.io-parser");b=g(8);var m=g(9),h=g(11),q=g(12);a.protocol=4;a.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");a.CONNECT=0;a.DISCONNECT=1;a.EVENT=2;a.ACK=3;a.ERROR=4;a.BINARY_EVENT=
5;a.BINARY_ACK=6;a.Encoder=f;a.Decoder=k;f.prototype.encode=function(b,d){(b.type!==a.EVENT&&b.type!==a.ACK||!m(b.data)||(b.type=b.type===a.EVENT?a.BINARY_EVENT:a.BINARY_ACK),n("encoding packet %j",b),a.BINARY_EVENT===b.type||a.BINARY_ACK===b.type)?e(b,d):(b=c(b),d([b]))};b(k.prototype);k.prototype.add=function(c){if("string"==typeof c){var b,e=0,h={type:Number(c.charAt(0))};if(null==a.types[h.type])c=l();else{if(a.BINARY_EVENT===h.type||a.BINARY_ACK===h.type){for(b="";"-"!==c.charAt(++e)&&(b+=c.charAt(e),
e!=c.length););if(b!=Number(b)||"-"!==c.charAt(e))throw Error("Illegal attachments");h.attachments=Number(b)}if("/"===c.charAt(e+1))for(h.nsp="";++e;){b=c.charAt(e);if(","===b)break;if(h.nsp+=b,e===c.length)break}else h.nsp="/";b=c.charAt(e+1);if(""!==b&&Number(b)==b){for(h.id="";++e;){b=c.charAt(e);if(null==b||Number(b)!=b){--e;break}if(h.id+=c.charAt(e),e===c.length)break}h.id=Number(h.id)}if(c.charAt(++e)){b:{e=c.substr(e);try{h.data=JSON.parse(e)}catch(u){e=l();break b}e=h}h=e}c=(n("decoded %s as %j",
c,h),h)}a.BINARY_EVENT===c.type||a.BINARY_ACK===c.type?(this.reconstructor=new d(c),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",c)):this.emit("decoded",c)}else{if(!q(c)&&!c.base64)throw Error("Unknown type: "+c);if(!this.reconstructor)throw Error("got binary data when not reconstructing a packet");(c=this.reconstructor.takeBinaryData(c))&&(this.reconstructor=null,this.emit("decoded",c))}};k.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};
d.prototype.takeBinaryData=function(a){return(this.buffers.push(a),this.buffers.length===this.reconPack.attachments)?(a=h.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),a):null};d.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},function(b,a,g){function f(a){if(a){for(var c in f.prototype)a[c]=f.prototype[c];return a}}b.exports=f;f.prototype.on=f.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks["$"+
a]=this._callbacks["$"+a]||[]).push(b),this};f.prototype.once=function(a,b){function c(){this.off(a,c);b.apply(this,arguments)}return c.fn=b,this.on(a,c),this};f.prototype.off=f.prototype.removeListener=f.prototype.removeAllListeners=f.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks["$"+a];if(!c)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var d,e=0;e<c.length;e++)if(d=
c[e],d===b||d.fn===b){c.splice(e,1);break}return this};f.prototype.emit=function(a){this._callbacks=this._callbacks||{};var c=[].slice.call(arguments,1),b=this._callbacks["$"+a];if(b){b=b.slice(0);for(var d=0,f=b.length;d<f;++d)b[d].apply(this,c)}return this};f.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]};f.prototype.hasListeners=function(a){return!!this.listeners(a).length}},function(b,a,g){(function(a){function c(b){if(!b||"object"!=typeof b)return!1;
if(e(b)){for(var f=0,h=b.length;f<h;f++)if(c(b[f]))return!0;return!1}if("function"==typeof a.Buffer&&a.Buffer.isBuffer&&a.Buffer.isBuffer(b)||"function"==typeof a.ArrayBuffer&&b instanceof ArrayBuffer||d&&b instanceof Blob||l&&b instanceof File)return!0;if(b.toJSON&&"function"==typeof b.toJSON&&1===arguments.length)return c(b.toJSON(),!0);for(f in b)if(Object.prototype.hasOwnProperty.call(b,f)&&c(b[f]))return!0;return!1}var e=g(10),f=Object.prototype.toString,d="function"==typeof a.Blob||"[object BlobConstructor]"===
f.call(a.Blob),l="function"==typeof a.File||"[object FileConstructor]"===f.call(a.File);b.exports=c}).call(a,function(){return this}())},function(b,a){var g={}.toString;b.exports=Array.isArray||function(a){return"[object Array]"==g.call(a)}},function(b,a,g){(function(b){function c(a,b){if(!a)return a;if(d(a)){var e={_placeholder:!0,num:b.length};return b.push(a),e}if(f(a)){e=Array(a.length);for(var h=0;h<a.length;h++)e[h]=c(a[h],b);return e}if("object"==typeof a&&!(a instanceof Date)){e={};for(h in a)e[h]=
c(a[h],b);return e}return a}function e(a,b){if(!a)return a;if(a&&a._placeholder)return b[a.num];if(f(a))for(var c=0;c<a.length;c++)a[c]=e(a[c],b);else if("object"==typeof a)for(c in a)a[c]=e(a[c],b);return a}var f=g(10),d=g(12),l=Object.prototype.toString,n="function"==typeof b.Blob||"[object BlobConstructor]"===l.call(b.Blob),m="function"==typeof b.File||"[object FileConstructor]"===l.call(b.File);a.deconstructPacket=function(a){var b=[];return a.data=c(a.data,b),a.attachments=b.length,{packet:a,
buffers:b}};a.reconstructPacket=function(a,b){return a.data=e(a.data,b),a.attachments=void 0,a};a.removeBlobs=function(a,b){function c(a,t,r){if(!a)return a;if(n&&a instanceof Blob||m&&a instanceof File){e++;var g=new FileReader;g.onload=function(){r?r[t]=this.result:h=this.result;--e||b(h)};g.readAsArrayBuffer(a)}else if(f(a))for(g=0;g<a.length;g++)c(a[g],g,a);else if("object"==typeof a&&!d(a))for(g in a)c(a[g],g,a)}var e=0,h=a;c(h);e||b(h)}}).call(a,function(){return this}())},function(b,a){(function(a){b.exports=
function(b){return a.Buffer&&a.Buffer.isBuffer(b)||a.ArrayBuffer&&b instanceof ArrayBuffer}}).call(a,function(){return this}())},function(b,a,g){function f(a,b){if(!(this instanceof f))return new f(a,b);a&&"object"===("undefined"==typeof a?"undefined":c(a))&&(b=a,a=void 0);b=b||{};b.path=b.path||"/socket.io";this.nsps={};this.subs=[];this.opts=b;this.reconnection(!1!==b.reconnection);this.reconnectionAttempts(b.reconnectionAttempts||1/0);this.reconnectionDelay(b.reconnectionDelay||1E3);this.reconnectionDelayMax(b.reconnectionDelayMax||
5E3);this.randomizationFactor(b.randomizationFactor||.5);this.backoff=new q({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==b.timeout?2E4:b.timeout);this.readyState="closed";this.uri=a;this.connecting=[];this.lastPing=null;this.encoding=!1;this.packetBuffer=[];a=b.parser||d;this.encoder=new a.Encoder;this.decoder=new a.Decoder;(this.autoConnect=!1!==b.autoConnect)&&this.open()}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?
function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=g(14),k=g(39);a=g(8);var d=g(7),l=g(41),n=g(42),m=g(3)("socket.io-client:manager"),h=g(37),q=g(43),r=Object.prototype.hasOwnProperty;b.exports=f;f.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var a in this.nsps)r.call(this.nsps,a)&&this.nsps[a].emit.apply(this.nsps[a],arguments)};f.prototype.updateSocketIds=function(){for(var a in this.nsps)r.call(this.nsps,
a)&&(this.nsps[a].id=this.generateId(a))};f.prototype.generateId=function(a){return("/"===a?"":a+"#")+this.engine.id};a(f.prototype);f.prototype.reconnection=function(a){return arguments.length?(this._reconnection=!!a,this):this._reconnection};f.prototype.reconnectionAttempts=function(a){return arguments.length?(this._reconnectionAttempts=a,this):this._reconnectionAttempts};f.prototype.reconnectionDelay=function(a){return arguments.length?(this._reconnectionDelay=a,this.backoff&&this.backoff.setMin(a),
this):this._reconnectionDelay};f.prototype.randomizationFactor=function(a){return arguments.length?(this._randomizationFactor=a,this.backoff&&this.backoff.setJitter(a),this):this._randomizationFactor};f.prototype.reconnectionDelayMax=function(a){return arguments.length?(this._reconnectionDelayMax=a,this.backoff&&this.backoff.setMax(a),this):this._reconnectionDelayMax};f.prototype.timeout=function(a){return arguments.length?(this._timeout=a,this):this._timeout};f.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&
this._reconnection&&0===this.backoff.attempts&&this.reconnect()};f.prototype.open=f.prototype.connect=function(a,b){if(m("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;m("opening %s",this.uri);var c=this.engine=e(this.uri,this.opts),d=this;this.readyState="opening";this.skipReconnect=!1;var h=l(c,"open",function(){d.onopen();a&&a()});b=l(c,"error",function(b){if(m("connect_error"),d.cleanup(),d.readyState="closed",d.emitAll("connect_error",b),a){var c=Error("Connection error");
c.data=b;a(c)}else d.maybeReconnectOnOpen()});if(!1!==this._timeout){var f=this._timeout;m("connect attempt will timeout after %d",f);var r=setTimeout(function(){m("connect attempt timed out after %d",f);h.destroy();c.close();c.emit("error","timeout");d.emitAll("connect_timeout",f)},f);this.subs.push({destroy:function(){clearTimeout(r)}})}return this.subs.push(h),this.subs.push(b),this};f.prototype.onopen=function(){m("open");this.cleanup();this.readyState="open";this.emit("open");var a=this.engine;
this.subs.push(l(a,"data",n(this,"ondata")));this.subs.push(l(a,"ping",n(this,"onping")));this.subs.push(l(a,"pong",n(this,"onpong")));this.subs.push(l(a,"error",n(this,"onerror")));this.subs.push(l(a,"close",n(this,"onclose")));this.subs.push(l(this.decoder,"decoded",n(this,"ondecoded")))};f.prototype.onping=function(){this.lastPing=new Date;this.emitAll("ping")};f.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)};f.prototype.ondata=function(a){this.decoder.add(a)};f.prototype.ondecoded=
function(a){this.emit("packet",a)};f.prototype.onerror=function(a){m("error",a);this.emitAll("error",a)};f.prototype.socket=function(a,b){function c(){~h(e.connecting,d)||e.connecting.push(d)}var d=this.nsps[a];if(!d){d=new k(this,a,b);this.nsps[a]=d;var e=this;d.on("connecting",c);d.on("connect",function(){d.id=e.generateId(a)});this.autoConnect&&c()}return d};f.prototype.destroy=function(a){a=h(this.connecting,a);~a&&this.connecting.splice(a,1);this.connecting.length||this.close()};f.prototype.packet=
function(a){m("writing packet %j",a);var b=this;a.query&&0===a.type&&(a.nsp+="?"+a.query);b.encoding?b.packetBuffer.push(a):(b.encoding=!0,this.encoder.encode(a,function(c){for(var d=0;d<c.length;d++)b.engine.write(c[d],a.options);b.encoding=!1;b.processPacketQueue()}))};f.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var a=this.packetBuffer.shift();this.packet(a)}};f.prototype.cleanup=function(){m("cleanup");for(var a=this.subs.length,b=0;b<a;b++)this.subs.shift().destroy();
this.packetBuffer=[];this.encoding=!1;this.lastPing=null;this.decoder.destroy()};f.prototype.close=f.prototype.disconnect=function(){m("disconnect");this.skipReconnect=!0;this.reconnecting=!1;"opening"===this.readyState&&this.cleanup();this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};f.prototype.onclose=function(a){m("onclose");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",a);this._reconnection&&!this.skipReconnect&&this.reconnect()};
f.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var a=this;if(this.backoff.attempts>=this._reconnectionAttempts)m("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var b=this.backoff.duration();m("will wait %dms before reconnect attempt",b);this.reconnecting=!0;var c=setTimeout(function(){a.skipReconnect||(m("attempting reconnect"),a.emitAll("reconnect_attempt",a.backoff.attempts),a.emitAll("reconnecting",a.backoff.attempts),
a.skipReconnect||a.open(function(b){b?(m("reconnect attempt error"),a.reconnecting=!1,a.reconnect(),a.emitAll("reconnect_error",b.data)):(m("reconnect success"),a.onreconnect())}))},b);this.subs.push({destroy:function(){clearTimeout(c)}})}};f.prototype.onreconnect=function(){var a=this.backoff.attempts;this.reconnecting=!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",a)}},function(b,a,g){b.exports=g(15)},function(b,a,g){b.exports=g(16);b.exports.parser=g(23)},function(b,a,
g){(function(a){function c(b,d){if(!(this instanceof c))return new c(b,d);d=d||{};b&&"object"==typeof b&&(d=b,b=null);b?(b=m(b),d.hostname=b.host,d.secure="https"===b.protocol||"wss"===b.protocol,d.port=b.port,b.query&&(d.query=b.query)):d.host&&(d.hostname=m(d.host).host);this.secure=null!=d.secure?d.secure:a.location&&"https:"===location.protocol;d.hostname&&!d.port&&(d.port=this.secure?"443":"80");this.agent=d.agent||!1;this.hostname=d.hostname||(a.location?location.hostname:"localhost");this.port=
d.port||(a.location&&location.port?location.port:this.secure?443:80);this.query=d.query||{};"string"==typeof this.query&&(this.query=q.decode(this.query));this.upgrade=!1!==d.upgrade;this.path=(d.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!d.forceJSONP;this.jsonp=!1!==d.jsonp;this.forceBase64=!!d.forceBase64;this.enablesXDR=!!d.enablesXDR;this.timestampParam=d.timestampParam||"t";this.timestampRequests=d.timestampRequests;this.transports=d.transports||["polling","websocket"];this.transportOptions=
d.transportOptions||{};this.readyState="";this.writeBuffer=[];this.prevBufferLen=0;this.policyPort=d.policyPort||843;this.rememberUpgrade=d.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=d.onlyBinaryUpgrades;this.perMessageDeflate=!1!==d.perMessageDeflate&&(d.perMessageDeflate||{});!0===this.perMessageDeflate&&(this.perMessageDeflate={});this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024);this.pfx=d.pfx||null;this.key=d.key||null;
this.passphrase=d.passphrase||null;this.cert=d.cert||null;this.ca=d.ca||null;this.ciphers=d.ciphers||null;this.rejectUnauthorized=void 0===d.rejectUnauthorized||d.rejectUnauthorized;this.forceNode=!!d.forceNode;b="object"==typeof a&&a;b.global===b&&(d.extraHeaders&&0<Object.keys(d.extraHeaders).length&&(this.extraHeaders=d.extraHeaders),d.localAddress&&(this.localAddress=d.localAddress));this.pingTimeoutTimer=this.pingIntervalTimer=this.pingTimeout=this.pingInterval=this.upgrades=this.id=null;this.open()}
var e=g(17),f=g(8),d=g(3)("engine.io-client:socket"),l=g(37),n=g(23),m=g(2),h=g(38),q=g(31);b.exports=c;c.priorWebsocketSuccess=!1;f(c.prototype);c.protocol=n.protocol;c.Socket=c;c.Transport=g(22);c.transports=g(17);c.parser=g(23);c.prototype.createTransport=function(a){d('creating transport "%s"',a);var b=this.query,c={},h;for(h in b)b.hasOwnProperty(h)&&(c[h]=b[h]);c.EIO=n.protocol;c.transport=a;b=this.transportOptions[a]||{};this.id&&(c.sid=this.id);return new e[a]({query:c,socket:this,agent:b.agent||
this.agent,hostname:b.hostname||this.hostname,port:b.port||this.port,secure:b.secure||this.secure,path:b.path||this.path,forceJSONP:b.forceJSONP||this.forceJSONP,jsonp:b.jsonp||this.jsonp,forceBase64:b.forceBase64||this.forceBase64,enablesXDR:b.enablesXDR||this.enablesXDR,timestampRequests:b.timestampRequests||this.timestampRequests,timestampParam:b.timestampParam||this.timestampParam,policyPort:b.policyPort||this.policyPort,pfx:b.pfx||this.pfx,key:b.key||this.key,passphrase:b.passphrase||this.passphrase,
cert:b.cert||this.cert,ca:b.ca||this.ca,ciphers:b.ciphers||this.ciphers,rejectUnauthorized:b.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:b.perMessageDeflate||this.perMessageDeflate,extraHeaders:b.extraHeaders||this.extraHeaders,forceNode:b.forceNode||this.forceNode,localAddress:b.localAddress||this.localAddress,requestTimeout:b.requestTimeout||this.requestTimeout,protocols:b.protocols||void 0})};c.prototype.open=function(){if(this.rememberUpgrade&&c.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))var a=
"websocket";else{if(0===this.transports.length){var b=this;return void setTimeout(function(){b.emit("error","No transports available")},0)}a=this.transports[0]}this.readyState="opening";try{a=this.createTransport(a)}catch(w){return this.transports.shift(),void this.open()}a.open();this.setTransport(a)};c.prototype.setTransport=function(a){d("setting transport %s",a.name);var b=this;this.transport&&(d("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=
a;a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})};c.prototype.probe=function(a){function b(){if(q.onlyBinaryUpgrades){var b=!this.supportsBinary&&q.transport.supportsBinary;n=n||b}n||(d('probe transport "%s" opened',a),k.send([{type:"ping",data:"probe"}]),k.once("packet",function(b){if(!n)if("pong"===b.type&&"probe"===b.data){if(d('probe transport "%s" pong',a),q.upgrading=!0,
q.emit("upgrading",k),k)c.priorWebsocketSuccess="websocket"===k.name,d('pausing current transport "%s"',q.transport.name),q.transport.pause(function(){n||"closed"!==q.readyState&&(d("changing transport and sending upgrade packet"),m(),q.setTransport(k),k.send([{type:"upgrade"}]),q.emit("upgrade",k),k=null,q.upgrading=!1,q.flush())})}else d('probe transport "%s" failed',a),b=Error("probe error"),b.transport=k.name,q.emit("upgradeError",b)}))}function e(){n||(n=!0,m(),k.close(),k=null)}function h(b){var c=
Error("probe error: "+b);c.transport=k.name;e();d('probe transport "%s" failed because of error: %s',a,b);q.emit("upgradeError",c)}function f(){h("transport closed")}function g(){h("socket closed")}function r(a){k&&a.name!==k.name&&(d('"%s" works - aborting "%s"',a.name,k.name),e())}function m(){k.removeListener("open",b);k.removeListener("error",h);k.removeListener("close",f);q.removeListener("close",g);q.removeListener("upgrading",r)}d('probing transport "%s"',a);var k=this.createTransport(a,{probe:1}),
n=!1,q=this;c.priorWebsocketSuccess=!1;k.once("open",b);k.once("error",h);k.once("close",f);this.once("close",g);this.once("upgrading",r);k.open()};c.prototype.onOpen=function(){if(d("socket open"),this.readyState="open",c.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){d("starting upgrade probes");for(var a=0,b=this.upgrades.length;a<b;a++)this.probe(this.upgrades[a])}};c.prototype.onPacket=function(a){if("opening"===
this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(d('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case "open":this.onHandshake(h(a.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var b=Error("server error");b.code=a.data;this.onError(b);break;case "message":this.emit("data",a.data),this.emit("message",a.data)}else d('packet received with socket readyState "%s"',this.readyState)};c.prototype.onHandshake=
function(a){this.emit("handshake",a);this.id=a.sid;this.transport.query.sid=a.sid;this.upgrades=this.filterUpgrades(a.upgrades);this.pingInterval=a.pingInterval;this.pingTimeout=a.pingTimeout;this.onOpen();"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};c.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!==b.readyState&&b.onClose("ping timeout")},
a||b.pingInterval+b.pingTimeout)};c.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer);a.pingIntervalTimer=setTimeout(function(){d("writing ping packet - expecting pong within %sms",a.pingTimeout);a.ping();a.onHeartbeat(a.pingTimeout)},a.pingInterval)};c.prototype.ping=function(){var a=this;this.sendPacket("ping",function(){a.emit("ping")})};c.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;0===this.writeBuffer.length?this.emit("drain"):
this.flush()};c.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(d("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};c.prototype.write=c.prototype.send=function(a,b,c){return this.sendPacket("message",a,b,c),this};c.prototype.sendPacket=function(a,b,c,d){if("function"==typeof b&&(d=b,b=void 0),"function"==typeof c&&(d=
c,c=null),"closing"!==this.readyState&&"closed"!==this.readyState)c=c||{},c.compress=!1!==c.compress,a={type:a,data:b,options:c},this.emit("packetCreate",a),this.writeBuffer.push(a),d&&this.once("flush",d),this.flush()};c.prototype.close=function(){function a(){e.onClose("forced close");d("socket closing - telling transport to close");e.transport.close()}function b(){e.removeListener("upgrade",b);e.removeListener("upgradeError",b);a()}function c(){e.once("upgrade",b);e.once("upgradeError",b)}if("opening"===
this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?c():a()}):this.upgrading?c():a()}return this};c.prototype.onError=function(a){d("socket error %j",a);c.priorWebsocketSuccess=!1;this.emit("error",a);this.onClose("transport error",a)};c.prototype.onClose=function(a,b){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)d('socket close with reason: "%s"',a),clearTimeout(this.pingIntervalTimer),
clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b),this.writeBuffer=[],this.prevBufferLen=0};c.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;c<d;c++)~l(this.transports,a[c])&&b.push(a[c]);return b}}).call(a,function(){return this}())},function(b,a,g){(function(b){var c=g(18),e=g(20),f=g(34),d=g(35);a.polling=function(a){var d,g=!1,h=
!1,k=!1!==a.jsonp;b.location&&(h="https:"===location.protocol,(g=location.port)||(g=h?443:80),g=a.hostname!==location.hostname||g!==a.port,h=a.secure!==h);if(a.xdomain=g,a.xscheme=h,d=new c(a),"open"in d&&!a.forceJSONP)return new e(a);if(!k)throw Error("JSONP disabled");return new f(a)};a.websocket=d}).call(a,function(){return this}())},function(b,a,g){(function(a){var c=g(19);b.exports=function(b){var e=b.xdomain,d=b.xscheme;b=b.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||c))return new XMLHttpRequest}catch(l){}try{if("undefined"!=
typeof XDomainRequest&&!d&&b)return new XDomainRequest}catch(l){}if(!e)try{return new (a[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(l){}}}).call(a,function(){return this}())},function(b,a){try{b.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(g){b.exports=!1}},function(b,a,g){(function(a){function c(){}function e(b){if(n.call(this,b),this.requestTimeout=b.requestTimeout,this.extraHeaders=b.extraHeaders,a.location){var c="https:"===location.protocol,
d=location.port;d||(d=c?443:80);this.xd=b.hostname!==a.location.hostname||d!==b.port;this.xs=b.secure!==c}}function f(a){this.method=a.method||"GET";this.uri=a.uri;this.xd=!!a.xd;this.xs=!!a.xs;this.async=!1!==a.async;this.data=void 0!==a.data?a.data:null;this.agent=a.agent;this.isBinary=a.isBinary;this.supportsBinary=a.supportsBinary;this.enablesXDR=a.enablesXDR;this.requestTimeout=a.requestTimeout;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=a.ca;this.ciphers=
a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.extraHeaders=a.extraHeaders;this.create()}function d(){for(var a in f.requests)f.requests.hasOwnProperty(a)&&f.requests[a].abort()}var l=g(18),n=g(21),m=g(8),h=g(32),q=g(3)("engine.io-client:polling-xhr");b.exports=e;b.exports.Request=f;h(e,n);e.prototype.supportsBinary=!0;e.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.xs=this.xs,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,a.enablesXDR=this.enablesXDR,
a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized,a.requestTimeout=this.requestTimeout,a.extraHeaders=this.extraHeaders,new f(a)};e.prototype.doWrite=function(a,b){a=this.request({method:"POST",data:a,isBinary:"string"!=typeof a&&void 0!==a});var c=this;a.on("success",b);a.on("error",function(a){c.onError("xhr post error",a)});this.sendXhr=a};e.prototype.doPoll=function(){q("xhr poll");var a=
this.request(),b=this;a.on("data",function(a){b.onData(a)});a.on("error",function(a){b.onError("xhr poll error",a)});this.pollXhr=a};m(f.prototype);f.prototype.create=function(){var b={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;var c=this.xhr=new l(b),d=this;try{q("xhr open %s: %s",this.method,this.uri);c.open(this.method,
this.uri,this.async);try{if(this.extraHeaders){c.setDisableHeaderCheck&&c.setDisableHeaderCheck(!0);for(var e in this.extraHeaders)this.extraHeaders.hasOwnProperty(e)&&c.setRequestHeader(e,this.extraHeaders[e])}}catch(u){}if("POST"===this.method)try{this.isBinary?c.setRequestHeader("Content-type","application/octet-stream"):c.setRequestHeader("Content-type","text/plain;charset\x3dUTF-8")}catch(u){}try{c.setRequestHeader("Accept","*/*")}catch(u){}"withCredentials"in c&&(c.withCredentials=!0);this.requestTimeout&&
(c.timeout=this.requestTimeout);this.hasXDR()?(c.onload=function(){d.onLoad()},c.onerror=function(){d.onError(c.responseText)}):c.onreadystatechange=function(){if(2===c.readyState){try{var a=c.getResponseHeader("Content-Type")}catch(z){}"application/octet-stream"===a&&(c.responseType="arraybuffer")}4===c.readyState&&(200===c.status||1223===c.status?d.onLoad():setTimeout(function(){d.onError(c.status)},0))};q("xhr data %s",this.data);c.send(this.data)}catch(u){return void setTimeout(function(){d.onError(u)},
0)}a.document&&(this.index=f.requestsCount++,f.requests[this.index]=this)};f.prototype.onSuccess=function(){this.emit("success");this.cleanup()};f.prototype.onData=function(a){this.emit("data",a);this.onSuccess()};f.prototype.onError=function(a){this.emit("error",a);this.cleanup(!0)};f.prototype.cleanup=function(b){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,b)try{this.xhr.abort()}catch(t){}a.document&&delete f.requests[this.index];
this.xhr=null}};f.prototype.onLoad=function(){try{try{var a=this.xhr.getResponseHeader("Content-Type")}catch(w){}var b="application/octet-stream"===a?this.xhr.response||this.xhr.responseText:this.xhr.responseText}catch(w){this.onError(w)}null!=b&&this.onData(b)};f.prototype.hasXDR=function(){return"undefined"!=typeof a.XDomainRequest&&!this.xs&&this.enablesXDR};f.prototype.abort=function(){this.cleanup()};f.requestsCount=0;f.requests={};a.document&&(a.attachEvent?a.attachEvent("onunload",d):a.addEventListener&&
a.addEventListener("beforeunload",d,!1))}).call(a,function(){return this}())},function(b,a,g){function f(a){var b=a&&a.forceBase64;n&&!b||(this.supportsBinary=!1);c.call(this,a)}var c=g(22),e=g(31),k=g(23);a=g(32);var d=g(33),l=g(3)("engine.io-client:polling");b.exports=f;var n=null!=(new (g(18))({xdomain:!1})).responseType;a(f,c);f.prototype.name="polling";f.prototype.doOpen=function(){this.poll()};f.prototype.pause=function(a){function b(){l("paused");c.readyState="paused";a()}var c=this;if(this.readyState=
"pausing",this.polling||!this.writable){var d=0;this.polling&&(l("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){l("pre-pause polling complete");--d||b()}));this.writable||(l("we are currently writing - waiting to pause"),d++,this.once("drain",function(){l("pre-pause writing complete");--d||b()}))}else b()};f.prototype.poll=function(){l("polling");this.polling=!0;this.doPoll();this.emit("poll")};f.prototype.onData=function(a){var b=this;l("polling got data %s",
a);k.decodePayload(a,this.socket.binaryType,function(a,c,d){return"opening"===b.readyState&&b.onOpen(),"close"===a.type?(b.onClose(),!1):void b.onPacket(a)});"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():l('ignoring poll - transport state "%s"',this.readyState))};f.prototype.doClose=function(){function a(){l("writing close packet");b.write([{type:"close"}])}var b=this;"open"===this.readyState?(l("transport open - closing"),a()):(l("transport not open - deferring close"),
this.once("open",a))};f.prototype.write=function(a){var b=this;this.writable=!1;var c=function(){b.writable=!0;b.emit("drain")};k.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,c)})};f.prototype.uri=function(){var a=this.query||{},b=this.secure?"https":"http",c="";!1!==this.timestampRequests&&(a[this.timestampParam]=d());this.supportsBinary||a.sid||(a.b64=1);a=e.encode(a);this.port&&("https"===b&&443!==Number(this.port)||"http"===b&&80!==Number(this.port))&&(c=":"+this.port);a.length&&
(a="?"+a);var f=-1!==this.hostname.indexOf(":");return b+"://"+(f?"["+this.hostname+"]":this.hostname)+c+this.path+a}},function(b,a,g){function f(a){this.path=a.path;this.hostname=a.hostname;this.port=a.port;this.secure=a.secure;this.query=a.query;this.timestampParam=a.timestampParam;this.timestampRequests=a.timestampRequests;this.readyState="";this.agent=a.agent||!1;this.socket=a.socket;this.enablesXDR=a.enablesXDR;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=
a.ca;this.ciphers=a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.forceNode=a.forceNode;this.extraHeaders=a.extraHeaders;this.localAddress=a.localAddress}var c=g(23);a=g(8);b.exports=f;a(f.prototype);f.prototype.onError=function(a,b){a=Error(a);return a.type="TransportError",a.description=b,this.emit("error",a),this};f.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this};f.prototype.close=function(){return"opening"!==
this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this};f.prototype.send=function(a){if("open"!==this.readyState)throw Error("Transport not open");this.write(a)};f.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};f.prototype.onData=function(a){a=c.decodePacket(a,this.socket.binaryType);this.onPacket(a)};f.prototype.onPacket=function(a){this.emit("packet",a)};f.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},
function(b,a,g){(function(b){function c(b,c,d){if(!c)return a.encodeBase64Packet(b,d);var e=new FileReader;return e.onload=function(){b.data=e.result;a.encodePacket(b,c,!0,d)},e.readAsArrayBuffer(b.data)}function e(a,b,c){var d=Array(a.length);c=m(a.length,c);for(var e=function(a,c,e){b(c,function(b,c){d[a]=c;e(b,d)})},h=0;h<a.length;h++)e(h,a[h],c)}var f,d=g(24),l=g(9),n=g(25),m=g(26),h=g(27);b&&b.ArrayBuffer&&(f=g(29));var q="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),r=
"undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),t=q||r;a.protocol=3;var w=a.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},I=d(w),u={type:"error",data:"parser error"},z=g(30);a.encodePacket=function(d,e,f,g){"function"==typeof e&&(g=e,e=!1);"function"==typeof f&&(g=f,f=null);var m=void 0===d.data?void 0:d.data.buffer||d.data;if(b.ArrayBuffer&&m instanceof ArrayBuffer){if(e){f=d.data;e=new Uint8Array(f);f=new Uint8Array(1+f.byteLength);f[0]=w[d.type];for(d=
0;d<e.length;d++)f[d+1]=e[d];d=g(f.buffer)}else d=a.encodeBase64Packet(d,g);return d}if(z&&m instanceof b.Blob)return e?t?d=c(d,e,g):(e=new Uint8Array(1),e[0]=w[d.type],d=new z([e.buffer,d.data]),d=g(d)):d=a.encodeBase64Packet(d,g),d;if(m&&m.base64)return g("b"+a.packets[d.type]+d.data.data);e=w[d.type];return void 0!==d.data&&(e+=f?h.encode(String(d.data),{strict:!1}):String(d.data)),g(""+e)};a.encodeBase64Packet=function(c,d){var e="b"+a.packets[c.type];if(z&&c.data instanceof b.Blob){var f=new FileReader;
return f.onload=function(){var a=f.result.split(",")[1];d(e+a)},f.readAsDataURL(c.data)}try{var h=String.fromCharCode.apply(null,new Uint8Array(c.data))}catch(P){c=new Uint8Array(c.data);h=Array(c.length);for(var g=0;g<c.length;g++)h[g]=c[g];h=String.fromCharCode.apply(null,h)}return e+=b.btoa(h),d(e)};a.decodePacket=function(b,c,d){if(void 0===b)return u;if("string"==typeof b){if("b"===b.charAt(0))return a.decodeBase64Packet(b.substr(1),c);if(c=d){c=b;try{c=h.decode(c,{strict:!1})}catch(A){c=!1}c=
(b=c,!1===b)}if(c)return u;d=b.charAt(0);return Number(d)==d&&I[d]?1<b.length?{type:I[d],data:b.substring(1)}:{type:I[d]}:u}d=(new Uint8Array(b))[0];b=n(b,1);return z&&"blob"===c&&(b=new z([b])),{type:I[d],data:b}};a.decodeBase64Packet=function(a,b){var c=I[a.charAt(0)];if(!f)return{type:c,data:{base64:!0,data:a.substr(1)}};a=f.decode(a.substr(1));return"blob"===b&&z&&(a=new z([a])),{type:c,data:a}};a.encodePayload=function(b,c,d){function f(b,d){a.encodePacket(b,!!h&&c,!1,function(a){d(null,a.length+
":"+a)})}"function"==typeof c&&(d=c,c=null);var h=l(b);return c&&h?z&&!t?a.encodePayloadAsBlob(b,d):a.encodePayloadAsArrayBuffer(b,d):b.length?void e(b,f,function(a,b){return d(b.join(""))}):d("0:")};a.decodePayload=function(b,c,d){if("string"!=typeof b)return a.decodePayloadAsBinary(b,c,d);"function"==typeof c&&(d=c,c=null);var e;if(""===b)return d(u,0,1);for(var f,h,g="",m=0,k=b.length;m<k;m++){var n=b.charAt(m);if(":"===n){if(""===g||g!=(f=Number(g))||(h=b.substr(m+1,f),g!=h.length))return d(u,
0,1);if(h.length){if(e=a.decodePacket(h,c,!1),u.type===e.type&&u.data===e.data)return d(u,0,1);if(!1===d(e,m+f,k))return}m+=f;g=""}else g+=n}return""!==g?d(u,0,1):void 0};a.encodePayloadAsArrayBuffer=function(b,c){function d(b,c){a.encodePacket(b,!0,!0,function(a){return c(null,a)})}return b.length?void e(b,d,function(a,b){a=b.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0);var d=new Uint8Array(a),e=0;return b.forEach(function(a){var b="string"==
typeof a,c=a;if(b){c=new Uint8Array(a.length);for(var f=0;f<a.length;f++)c[f]=a.charCodeAt(f);c=c.buffer}b?d[e++]=0:d[e++]=1;a=c.byteLength.toString();for(f=0;f<a.length;f++)d[e++]=parseInt(a[f]);d[e++]=255;c=new Uint8Array(c);for(f=0;f<c.length;f++)d[e++]=c[f]}),c(d.buffer)}):c(new ArrayBuffer(0))};a.encodePayloadAsBlob=function(b,c){e(b,function(b,c){a.encodePacket(b,!0,!0,function(a){var b=new Uint8Array(1);if(b[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),e=0;e<a.length;e++)d[e]=
a.charCodeAt(e);a=d.buffer;b[0]=0}d=(a instanceof ArrayBuffer?a.byteLength:a.size).toString();var f=new Uint8Array(d.length+1);for(e=0;e<d.length;e++)f[e]=parseInt(d[e]);if(f[d.length]=255,z)a=new z([b.buffer,f.buffer,a]),c(null,a)})},function(a,b){return c(new z(b))})};a.decodePayloadAsBinary=function(b,c,d){"function"==typeof c&&(d=c,c=null);for(var e=[];0<b.byteLength;){for(var f=new Uint8Array(b),h=0===f[0],g="",m=1;255!==f[m];m++){if(310<g.length)return d(u,0,1);g+=f[m]}b=n(b,2+g.length);g=parseInt(g);
f=n(b,0,g);if(h)try{f=String.fromCharCode.apply(null,new Uint8Array(f))}catch(D){for(h=new Uint8Array(f),f="",m=0;m<h.length;m++)f+=String.fromCharCode(h[m])}e.push(f);b=n(b,g)}var k=e.length;e.forEach(function(b,e){d(a.decodePacket(b,c,!0),e,k)})}}).call(a,function(){return this}())},function(b,a){b.exports=Object.keys||function(a){var b=[],c=Object.prototype.hasOwnProperty,e;for(e in a)c.call(a,e)&&b.push(e);return b}},function(b,a){b.exports=function(a,b,c){var e=a.byteLength;if(b=b||0,c=c||e,
a.slice)return a.slice(b,c);if(0>b&&(b+=e),0>c&&(c+=e),c>e&&(c=e),b>=e||b>=c||0===e)return new ArrayBuffer(0);a=new Uint8Array(a);e=new Uint8Array(c-b);for(var f=0;b<c;b++,f++)e[f]=a[b];return e.buffer}},function(b,a){function g(){}b.exports=function(a,b,e){function c(a,f){if(0>=c.count)throw Error("after called too many times");--c.count;a?(d=!0,b(a),b=e):0!==c.count||d||b(null,f)}var d=!1;return e=e||g,c.count=a,0===a?b():c}},function(b,a,g){var f;(function(b,e){!function(c){function d(a){for(var b,
c,d=[],e=0,f=a.length;e<f;)b=a.charCodeAt(e++),55296<=b&&56319>=b&&e<f?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function e(a,b){if(55296<=a&&57343>=a){if(b)throw Error("Lone surrogate U+"+a.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function g(){if(r>=k)throw Error("Invalid byte index");var a=255&h[r];if(r++,128==(192&a))return 63&a;throw Error("Invalid continuation byte");}function m(a){var b,c,d,f,
m;if(r>k)throw Error("Invalid byte index");if(r==k)return!1;if(b=255&h[r],r++,0==(128&b))return b;if(192==(224&b)){if(c=g(),m=(31&b)<<6|c,128<=m)return m;throw Error("Invalid continuation byte");}if(224==(240&b)){if(c=g(),d=g(),m=(15&b)<<12|c<<6|d,2048<=m)return e(m,a)?m:65533;throw Error("Invalid continuation byte");}if(240==(248&b)&&(c=g(),d=g(),f=g(),m=(7&b)<<18|c<<12|d<<6|f,65536<=m&&1114111>=m))return m;throw Error("Invalid UTF-8 detected");}c="object"==typeof a&&a;"object"==typeof b&&b&&b.exports==
c&&b;var h,k,r,t=String.fromCharCode;f={version:"2.1.2",encode:function(a,b){b=b||{};b=!1!==b.strict;a=d(a);for(var c=a.length,f=-1,h="";++f<c;){var g=a[f];var m=b;if(0==(4294967168&g))m=t(g);else{var k="";m=(0==(4294965248&g)?k=t(g>>6&31|192):0==(4294901760&g)?(e(g,m)||(g=65533),k=t(g>>12&15|224),k+=t(g>>6&63|128)):0==(4292870144&g)&&(k=t(g>>18&7|240),k+=t(g>>12&63|128),k+=t(g>>6&63|128)),k+t(63&g|128))}h+=m}return h},decode:function(a,b){b=b||{};b=!1!==b.strict;h=d(a);k=h.length;r=0;var c;for(a=
[];!1!==(c=m(b));)a.push(c);c=a.length;for(var e=-1,f="";++e<c;)b=a[e],65535<b&&(b-=65536,f+=t(b>>>10&1023|55296),b=56320|1023&b),f+=t(b);return f}};!(void 0!==f&&(b.exports=f))}(this)}).call(a,g(28)(b),function(){return this}())},function(b,a){b.exports=function(a){return a.webpackPolyfill||(a.deprecate=function(){},a.paths=[],a.children=[],a.webpackPolyfill=1),a}},function(b,a){!function(){for(var b=new Uint8Array(256),f=0;64>f;f++)b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(f)]=
f;a.encode=function(a){var b=new Uint8Array(a),c=b.length,d="";for(a=0;a<c;a+=3)d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b[a]>>2],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&b[a])<<4|b[a+1]>>4],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&b[a+1])<<2|b[a+2]>>6],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&b[a+2]];return 2===c%3?d=d.substring(0,d.length-1)+"\x3d":1===c%3&&(d=d.substring(0,
d.length-2)+"\x3d\x3d"),d};a.decode=function(a){var c=.75*a.length;var f=a.length,d=0;"\x3d"===a[a.length-1]&&(c--,"\x3d"===a[a.length-2]&&c--);var g=new ArrayBuffer(c),n=new Uint8Array(g);for(c=0;c<f;c+=4){var m=b[a.charCodeAt(c)];var h=b[a.charCodeAt(c+1)];var q=b[a.charCodeAt(c+2)];var r=b[a.charCodeAt(c+3)];n[d++]=m<<2|h>>4;n[d++]=(15&h)<<4|q>>2;n[d++]=(3&q)<<6|63&r}return g}}()},function(b,a){(function(a){function f(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.buffer instanceof ArrayBuffer){var d=
c.buffer;if(c.byteLength!==d.byteLength){var e=new Uint8Array(c.byteLength);e.set(new Uint8Array(d,c.byteOffset,c.byteLength));d=e.buffer}a[b]=d}}}function c(a,b){b=b||{};var c=new g;f(a);for(var d=0;d<a.length;d++)c.append(a[d]);return b.type?c.getBlob(b.type):c.getBlob()}function e(a,b){return f(a),new Blob(a,b||{})}var g=a.BlobBuilder||a.WebKitBlobBuilder||a.MSBlobBuilder||a.MozBlobBuilder;try{var d=2===(new Blob(["hi"])).size}catch(m){d=!1}var l;if(l=d)try{l=2===(new Blob([new Uint8Array([1,2])])).size}catch(m){l=
!1}var n=g&&g.prototype.append&&g.prototype.getBlob;b.exports=d?l?a.Blob:e:n?c:void 0}).call(a,function(){return this}())},function(b,a){a.encode=function(a){var b="",c;for(c in a)a.hasOwnProperty(c)&&(b.length&&(b+="\x26"),b+=encodeURIComponent(c)+"\x3d"+encodeURIComponent(a[c]));return b};a.decode=function(a){var b={};a=a.split("\x26");for(var c=0,e=a.length;c<e;c++){var g=a[c].split("\x3d");b[decodeURIComponent(g[0])]=decodeURIComponent(g[1])}return b}},function(b,a){b.exports=function(a,b){var c=
function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a}},function(b,a){function g(a){var b="";do b=e[a%k]+b,a=Math.floor(a/k);while(0<a);return b}function f(){var a=g(+new Date);return a!==c?(l=0,c=a):a+"."+g(l++)}for(var c,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),k=64,d={},l=0,n=0;n<k;n++)d[e[n]]=n;f.encode=g;f.decode=function(a){var b=0;for(n=0;n<a.length;n++)b=b*k+d[a.charAt(n)];return b};b.exports=f},function(b,a,g){(function(a){function c(){}
function e(b){f.call(this,b);this.query=this.query||{};l||(a.___eio||(a.___eio=[]),l=a.___eio);this.index=l.length;var d=this;l.push(function(a){d.onData(a)});this.query.j=this.index;a.document&&a.addEventListener&&a.addEventListener("beforeunload",function(){d.script&&(d.script.onerror=c)},!1)}var f=g(21),d=g(32);b.exports=e;var l,n=/\n/g,m=/\\n/g;d(e,f);e.prototype.supportsBinary=!1;e.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&
(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null);f.prototype.doClose.call(this)};e.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);b.async=!0;b.src=this.uri();b.onerror=function(b){a.onError("jsonp poll error",b)};var c=document.getElementsByTagName("script")[0];c?c.parentNode.insertBefore(b,c):(document.head||document.body).appendChild(b);this.script=b;"undefined"!=
typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};e.prototype.doWrite=function(a,b){function c(){d();b()}function d(){if(f.iframe)try{f.form.removeChild(f.iframe)}catch(H){f.onError("jsonp polling iframe removal error",H)}try{e=document.createElement('\x3ciframe src\x3d"javascript:0" name\x3d"'+f.iframeId+'"\x3e')}catch(H){e=document.createElement("iframe"),e.name=f.iframeId,
e.src="javascript:0"}e.id=f.iframeId;f.form.appendChild(e);f.iframe=e}var e,f=this;if(!this.form){var h=document.createElement("form"),g=document.createElement("textarea"),k=this.iframeId="eio_iframe_"+this.index;h.className="socketio";h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";h.target=k;h.method="POST";h.setAttribute("accept-charset","utf-8");g.name="d";h.appendChild(g);document.body.appendChild(h);this.form=h;this.area=g}this.form.action=this.uri();d();a=a.replace(m,
"\\\n");this.area.value=a.replace(n,"\\n");try{this.form.submit()}catch(H){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===f.iframe.readyState&&c()}:this.iframe.onload=c}}).call(a,function(){return this}())},function(b,a,g){(function(a){function c(a){a&&a.forceBase64&&(this.supportsBinary=!1);this.perMessageDeflate=a.perMessageDeflate;this.usingBrowserWebSocket=h&&!a.forceNode;this.protocols=a.protocols;this.usingBrowserWebSocket||(r=q);e.call(this,a)}var e=g(22),f=
g(23),d=g(31),l=g(32),n=g(33),m=g(3)("engine.io-client:websocket"),h=a.WebSocket||a.MozWebSocket;if("undefined"==typeof window)try{var q=g(36)}catch(t){}var r=h;r||"undefined"!=typeof window||(r=q);b.exports=c;l(c,e);c.prototype.name="websocket";c.prototype.supportsBinary=!0;c.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b=this.protocols,c={agent:this.agent,perMessageDeflate:this.perMessageDeflate};c.pfx=this.pfx;c.key=this.key;c.passphrase=this.passphrase;c.cert=this.cert;c.ca=this.ca;
c.ciphers=this.ciphers;c.rejectUnauthorized=this.rejectUnauthorized;this.extraHeaders&&(c.headers=this.extraHeaders);this.localAddress&&(c.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?b?new r(a,b):new r(a):new r(a,b,c)}catch(u){return this.emit("error",u)}void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer";this.addEventListeners()}};c.prototype.addEventListeners=
function(){var a=this;this.ws.onopen=function(){a.onOpen()};this.ws.onclose=function(){a.onClose()};this.ws.onmessage=function(b){a.onData(b.data)};this.ws.onerror=function(b){a.onError("websocket error",b)}};c.prototype.write=function(b){function c(){d.emit("flush");setTimeout(function(){d.writable=!0;d.emit("drain")},0)}var d=this;this.writable=!1;for(var e=b.length,h=0,g=e;h<g;h++)!function(b){f.encodePacket(b,d.supportsBinary,function(f){if(!d.usingBrowserWebSocket){var h={};(b.options&&(h.compress=
b.options.compress),d.perMessageDeflate)&&("string"==typeof f?a.Buffer.byteLength(f):f.length)<d.perMessageDeflate.threshold&&(h.compress=!1)}try{d.usingBrowserWebSocket?d.ws.send(f):d.ws.send(f,h)}catch(v){m("websocket closed before onclose event")}--e||c()})}(b[h])};c.prototype.onClose=function(){e.prototype.onClose.call(this)};c.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()};c.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";this.port&&("wss"===
b&&443!==Number(this.port)||"ws"===b&&80!==Number(this.port))&&(c=":"+this.port);this.timestampRequests&&(a[this.timestampParam]=n());this.supportsBinary||(a.b64=1);a=d.encode(a);a.length&&(a="?"+a);var e=-1!==this.hostname.indexOf(":");return b+"://"+(e?"["+this.hostname+"]":this.hostname)+c+this.path+a};c.prototype.check=function(){return!(!r||"__initialize"in r&&this.name===c.prototype.name)}}).call(a,function(){return this}())},function(b,a){},function(b,a){var g=[].indexOf;b.exports=function(a,
b){if(g)return a.indexOf(b);for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}},function(b,a){(function(a){var f=/^[\],:{}\s]*$/,c=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,e=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,g=/(?:^|:|,)(?:\s*\[)+/g,d=/^\s+/,l=/\s+$/;b.exports=function(b){return"string"==typeof b&&b?(b=b.replace(d,"").replace(l,""),a.JSON&&JSON.parse?JSON.parse(b):f.test(b.replace(c,"@").replace(e,"]").replace(g,""))?(new Function("return "+b))():void 0):null}}).call(a,
function(){return this}())},function(b,a,g){function f(a,b,c){this.io=a;this.nsp=b;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0;c&&c.query&&(this.query=c.query);this.io.autoConnect&&this.open()}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=g(7);a=g(8);var k=g(40),
d=g(41),l=g(42),n=g(3)("socket.io-client:socket"),m=g(31);b.exports=f;var h={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},q=a.prototype.emit;a(f.prototype);f.prototype.subEvents=function(){if(!this.subs){var a=this.io;this.subs=[d(a,"open",l(this,"onopen")),d(a,"packet",l(this,"onpacket")),d(a,"close",l(this,"onclose"))]}};f.prototype.open=f.prototype.connect=function(){return this.connected?
this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)};f.prototype.send=function(){var a=k(arguments);return a.unshift("message"),this.emit.apply(this,a),this};f.prototype.emit=function(a){if(h.hasOwnProperty(a))return q.apply(this,arguments),this;var b=k(arguments),c={type:e.EVENT,data:b};return c.options={},c.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof b[b.length-1]&&(n("emitting packet with ack id %d",this.ids),
this.acks[this.ids]=b.pop(),c.id=this.ids++),this.connected?this.packet(c):this.sendBuffer.push(c),delete this.flags,this};f.prototype.packet=function(a){a.nsp=this.nsp;this.io.packet(a)};f.prototype.onopen=function(){if(n("transport is open - connecting"),"/"!==this.nsp)if(this.query){var a="object"===c(this.query)?m.encode(this.query):this.query;n("sending connect packet with query %s",a);this.packet({type:e.CONNECT,query:a})}else this.packet({type:e.CONNECT})};f.prototype.onclose=function(a){n("close (%s)",
a);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",a)};f.prototype.onpacket=function(a){if(a.nsp===this.nsp)switch(a.type){case e.CONNECT:this.onconnect();break;case e.EVENT:this.onevent(a);break;case e.BINARY_EVENT:this.onevent(a);break;case e.ACK:this.onack(a);break;case e.BINARY_ACK:this.onack(a);break;case e.DISCONNECT:this.ondisconnect();break;case e.ERROR:this.emit("error",a.data)}};f.prototype.onevent=function(a){var b=a.data||[];n("emitting event %j",b);null!=
a.id&&(n("attaching ack callback to event"),b.push(this.ack(a.id)));this.connected?q.apply(this,b):this.receiveBuffer.push(b)};f.prototype.ack=function(a){var b=this,c=!1;return function(){if(!c){c=!0;var d=k(arguments);n("sending ack %j",d);b.packet({type:e.ACK,id:a,data:d})}}};f.prototype.onack=function(a){var b=this.acks[a.id];"function"==typeof b?(n("calling ack %s with %j",a.id,a.data),b.apply(this,a.data),delete this.acks[a.id]):n("bad ack %s",a.id)};f.prototype.onconnect=function(){this.connected=
!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};f.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)q.apply(this,this.receiveBuffer[a]);this.receiveBuffer=[];for(a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]};f.prototype.ondisconnect=function(){n("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};f.prototype.destroy=function(){if(this.subs){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();
this.subs=null}this.io.destroy(this)};f.prototype.close=f.prototype.disconnect=function(){return this.connected&&(n("performing disconnect (%s)",this.nsp),this.packet({type:e.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this};f.prototype.compress=function(a){return this.flags=this.flags||{},this.flags.compress=a,this}},function(b,a){b.exports=function(a,b){for(var c=[],e=(b=b||0)||0;e<a.length;e++)c[e-b]=a[e];return c}},function(b,a){b.exports=function(a,b,c){return a.on(b,
c),{destroy:function(){a.removeListener(b,c)}}}},function(b,a){var g=[].slice;b.exports=function(a,b){if("string"==typeof b&&(b=a[b]),"function"!=typeof b)throw Error("bind() requires a function");var c=g.call(arguments,2);return function(){return b.apply(a,c.concat(g.call(arguments)))}}},function(b,a){function g(a){a=a||{};this.ms=a.min||100;this.max=a.max||1E4;this.factor=a.factor||2;this.jitter=0<a.jitter&&1>=a.jitter?a.jitter:0;this.attempts=0}b.exports=g;g.prototype.duration=function(){var a=
this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var b=Math.random(),e=Math.floor(b*this.jitter*a);a=0==(1&Math.floor(10*b))?a-e:a+e}return 0|Math.min(a,this.max)};g.prototype.reset=function(){this.attempts=0};g.prototype.setMin=function(a){this.ms=a};g.prototype.setMax=function(a){this.max=a};g.prototype.setJitter=function(a){this.jitter=a}}])});var TK=TK||{};
TK.EventDispatcher=function(b){var a={};b.dispatcher={};b.dispatcher.eventListeners={};b.dispatcher.backupListerners={};a.addEventListener=function(a,f,c){void 0===b.dispatcher.eventListeners[a]&&(b.dispatcher.eventListeners[a]=[]);b.dispatcher.eventListeners[a].push(f);c&&(void 0===b.dispatcher.backupListerners[c]&&(b.dispatcher.backupListerners[c]=[]),b.dispatcher.backupListerners[c].push({eventType:a,listener:f}))};a.removeEventListener=function(a,f){b.dispatcher.eventListeners[a]?(f=b.dispatcher.eventListeners[a].indexOf(f),
-1!==f&&b.dispatcher.eventListeners[a].splice(f,1)):L.Logger.info("[tk-sdk]not event type: "+a)};a.removeAllEventListener=function(g){if(g&&"object"===typeof g&&"number"===typeof g.length&&"function"===typeof g.splice&&!g.propertyIsEnumerable("length"))for(var f in g){var c=g[f];delete b.dispatcher.eventListeners[c]}else if("string"===typeof g)delete b.dispatcher.eventListeners[g];else if("object"===typeof g)for(var e in g)c=e,a.removeEventListener(c,g[e])};a.dispatchEvent=function(a,f){var c;(void 0!=
f?f:1)&&L.Logger.debug("[tk-sdk]dispatchEvent , event type: "+a.type);for(c in b.dispatcher.eventListeners[a.type])if(b.dispatcher.eventListeners[a.type].hasOwnProperty(c))b.dispatcher.eventListeners[a.type][c](a)};a.removeBackupListerner=function(g){if(g&&b.dispatcher.backupListerners[g]){for(var f=0;f<b.dispatcher.backupListerners[g].length;f++){var c=b.dispatcher.backupListerners[g][f];a.removeEventListener(c.eventType,c.listener)}b.dispatcher.backupListerners[g].length=0;delete b.dispatcher.backupListerners[g]}};
return a};TK.TalkEvent=function(b){var a={};a.type=b.type;return a};TK.RoomEvent=function(b){var a=TK.TalkEvent(b);a.streams=b.streams;a.message=b.message;a.user=b.user;return a};TK.StreamEvent=function(b){var a=TK.TalkEvent(b);a.stream=b.stream;a.message=b.message;a.bandwidth=b.bandwidth;a.attrs=b.attrs;return a};TK.PublisherEvent=function(b){return TK.TalkEvent(b)};TK=TK||{};
TK.TkChromeStableStack=function(b){var a={},g=webkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.iceServers&&(a.pcConfig.iceServers=b.iceServers);void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};var f=function(a){L.Logger.error("[tk-sdk]Error in Stack ",a)};a.peerConnection=new g(a.pcConfig,a.con);var c=function(a){var b="a\x3dssrc-group:SIM";a.forEach(function(a){b+=
" "+a});return b+"\r\n"},e=function(a){if(!b.video||!b.simulcast)return a;var d=a.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!d||0>=d.length)return a;var e=b.simulcast.numSpatialLayers||2;var f=parseInt(d[1]),h=parseInt(d[2]),g=a.match(new RegExp("a\x3dssrc:"+d[1]+" cname:(.*)\r?\n"))[1],m=a.match(new RegExp("a\x3dssrc:"+d[1]+" msid:(.*)\r?\n"))[1],k=a.match(new RegExp("a\x3dssrc:"+d[1]+" mslabel:(.*)\r?\n"))[1],n=a.match(new RegExp("a\x3dssrc:"+d[1]+" label:(.*)\r?\n"))[1];a.match(new RegExp("a\x3dssrc:"+
d[1]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});a.match(new RegExp("a\x3dssrc:"+d[2]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});for(var l=[f],E=[h],A=1;A<e;A++)l.push(f+1E3*A),E.push(h+1E3*A);e=c(l);for(var v in l)f=l[v],h=E[v],e+="a\x3dssrc-group:FID "+f+" "+h+"\r\n";for(v in l)f=l[v],h=E[v],e+="a\x3dssrc:"+f+" cname:"+g+"\r\na\x3dssrc:"+f+" msid:"+m+"\r\na\x3dssrc:"+f+" mslabel:"+k+"\r\na\x3dssrc:"+f+" label:"+n+"\r\na\x3dssrc:"+h+" cname:"+g+"\r\na\x3dssrc:"+h+" msid:"+
m+"\r\na\x3dssrc:"+h+" mslabel:"+k+"\r\na\x3dssrc:"+h+" label:"+n+"\r\n";return a.replace(d[0],e+"a\x3dx-google-flag:conference\r\n")},k=function(a){if(b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var c=a.match(/m=video.*\r\n/);null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.audio&&b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],
d)));return a};a.close=function(){a.state="closed";a.peerConnection.close()};b.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a={sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid,candidate:a.candidate.candidate}):(L.Logger.info("[tk-sdk]Gathered all candidates. Sending END candidate"),a={sdpMLineIndex:-1,sdpMid:"end",candidate:"end"});b.remoteDescriptionSet?b.callback({type:"candidate",
candidate:a}):(b.localCandidates.push(a),L.Logger.info("[tk-sdk]Storing candidate: ",b.localCandidates.length,a))};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.target.iceConnectionState)};var d,l,n=function(a,c){a||(c.sdp=e(c.sdp));c.sdp=k(c.sdp);a=c.sdp;var f=a.match(/a=rtpmap:(.*)opus.*\r\n/);
null!==f&&(a=a.replace(f[0],f[0]+"a\x3drtcp-fb:"+f[1]+"nack\r\n"));c.sdp=a;c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,"");c.sdp=c.sdp.replace(/a=rtcp-fb:\d+ transport-cc\r\n/g,"");b.callback({type:c.type,sdp:c.sdp});d=c},m=function(c){c.sdp=k(c.sdp);b.callback({type:c.type,sdp:c.sdp});d=c;a.peerConnection.setLocalDescription(c)};a.updateSpec=function(c,e){if(c.maxVideoBW||c.maxAudioBW)c.maxVideoBW&&(L.Logger.debug("[tk-sdk]Maxvideo Requested:",c.maxVideoBW,"limit:",b.limitMaxVideoBW),c.maxVideoBW>
b.limitMaxVideoBW&&(c.maxVideoBW=b.limitMaxVideoBW),b.maxVideoBW=c.maxVideoBW,L.Logger.debug("[tk-sdk]Result",b.maxVideoBW)),c.maxAudioBW&&(c.maxAudioBW>b.limitMaxAudioBW&&(c.maxAudioBW=b.limitMaxAudioBW),b.maxAudioBW=c.maxAudioBW),d.sdp=k(d.sdp),c.Sdp||c.maxAudioBW?(L.Logger.debug("[tk-sdk]Updating with SDP renegotiation",b.maxVideoBW,b.maxAudioBW),a.peerConnection.setLocalDescription(d,function(){l.sdp=k(l.sdp);a.peerConnection.setRemoteDescription(new RTCSessionDescription(l),function(){b.remoteDescriptionSet=
!0;b.callback({type:"updatestream",sdp:d.sdp})})},function(a){L.Logger.error("[tk-sdk]Error updating configuration",a);e("error")})):(L.Logger.debug("[tk-sdk]Updating without SDP renegotiation, newVideoBW:",b.maxVideoBW,"newAudioBW:",b.maxAudioBW),b.callback({type:"updatestream",sdp:d.sdp}));if(c.minVideoBW||void 0!==c.slideShowMode||void 0!==c.muteStream||void 0!==c.qualityLayer)L.Logger.debug("[tk-sdk]MinVideo Changed to ",c.minVideoBW),L.Logger.debug("[tk-sdk]SlideShowMode Changed to ",c.slideShowMode),
L.Logger.debug("[tk-sdk]muteStream changed to ",c.muteStream),b.callback({type:"updatestream",config:c})};a.createOffer=function(b){!0!==b&&(a.mediaConstraints={mandatory:{OfferToReceiveVideo:!1,OfferToReceiveAudio:!1}});a.peerConnection.createOffer(n.bind(null,b),f,a.mediaConstraints)};a.addStream=function(b){b?a.peerConnection.addStream(b):L.Logger.error("[tk-sdk]chromeStableStack addStream : stream is not exist!")};a.removeStream=function(b){a.peerConnection.removeStream(b)};a.getStats=function(){return a.peerConnection.getStats()};
b.remoteCandidates=[];b.remoteDescriptionSet=!1;a.processSignalingMessage=function(c){L.Logger.info("[tk-sdk]Process Signaling Message",c);if("offer"===c.type)c.sdp=k(c.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){a.peerConnection.createAnswer(m,function(a){L.Logger.error("[tk-sdk]Error: ",a)},a.mediaConstraints);b.remoteDescriptionSet=!0},function(a){L.Logger.error("[tk-sdk]Error setting Remote Description",a)});else if("answer"===c.type)L.Logger.info("[tk-sdk]Set remote and local description"),
L.Logger.debug("[tk-sdk]Remote Description",c.sdp),L.Logger.debug("[tk-sdk]Local Description",d.sdp),c.sdp=k(c.sdp),l=c,a.peerConnection.setLocalDescription(d,function(){a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){b.remoteDescriptionSet=!0;for(L.Logger.info("[tk-sdk]Candidates to be added: ",b.remoteCandidates.length,b.remoteCandidates);0<b.remoteCandidates.length;)a.peerConnection.addIceCandidate(b.remoteCandidates.shift());for(L.Logger.info("[tk-sdk]Local candidates to send:",
b.localCandidates.length);0<b.localCandidates.length;)b.callback({type:"candidate",candidate:b.localCandidates.shift()})})});else if("candidate"===c.type)try{var e="object"===typeof c.candidate?c.candidate:JSON.parse(c.candidate);if("end"!==e.candidate){e.candidate=e.candidate.replace(/a=/g,"");e.sdpMLineIndex=parseInt(e.sdpMLineIndex);var f=new RTCIceCandidate(e);b.remoteDescriptionSet?a.peerConnection.addIceCandidate(f):b.remoteCandidates.push(f)}}catch(t){L.Logger.error("[tk-sdk]Error parsing candidate",
c.candidate)}};return a};TK=TK||{};TK.nativeEntry=function(){var b=document.createElement("embed");document.body.appendChild(b);b.setAttribute("id","tknative");b.setAttribute("mainentry",!0);b.setAttribute("hidden",!0);b.setAttribute("type","application/x-ppapi-proxy");return b};
TK.nativePeerConnection=function(b){var a={},g={},f=b.cnnId;a.onicecandidate=null;a.onaddstream=null;a.onremovestream=null;a.oniceconnectionstatechange=null;tknative.addEventListener("message",function(b){var c=b.data.name;if(b.data.connectionId==f){if("onLocalDescription"===c){var k={};k.sdp=b.data.sdp;k.type="offer";g.createOffer_suc(k);delete g.createOffer_suc;delete g.createOffer_fai}"onIceCandidate"===c&&a.onicecandidate&&(k={candidate:{}},k.candidate.sdpMLineIndex=b.data.sdpMLineIndex,k.candidate.sdpMid=
b.data.sdpMid,k.candidate.candidate=b.data.candidate,a.onicecandidate(k));if("onAddStream"===c)a.onaddstream({stream:{}})}},!1);a.close=function(){tknative.postMessage({command:"closeConnection",streamId:f.toString()})};a.createOffer=function(a,b,k){k||(k=!1);tknative.postMessage({command:"createOffer",streamId:f.toString(),includeLocalMedia:!k,hasAudio:!0,hasVideo:!0});g.createOffer_suc=a;g.createOffer_fai=b};a.setRemoteDescription=function(a,b,g){tknative.postMessage({command:"setRemoteDescription",
sdpAnswer:a.sdp,streamId:f.toString()});b&&"function"===typeof b&&b()};a.addIceCandidate=function(a){tknative.postMessage({command:"setIceCandidate",candidate:a.candidate,sdpMid:0,sdpMLineIndex:a.sdpMLineIndex,streamId:f.toString()})};a.addStream=function(a){tknative.postMessage({command:"addStream",streamId:f.toString()})};a.removeStream=function(a){tknative.postMessage({command:"removeStream",streamId:f.toString()})};a.setLocalDescription=function(a){};a.getStats=function(){return{}};return a};TK=TK||{};
TK.TkNativeStack=function(b){var a={},g=TK.nativePeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.iceServers&&(a.pcConfig.iceServers=b.iceServers);void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};var f=function(a){L.Logger.error("Error in Stack ",a)};a.peerConnection=new g(b);var c=function(a){var b="a\x3dssrc-group:SIM";a.forEach(function(a){b+=" "+
a});return b+"\r\n"},e=function(a){if(!b.video||!b.simulcast)return a;var d=a.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!d||0>=d.length)return a;var e=b.simulcast.numSpatialLayers||2;var f=parseInt(d[1]),g=parseInt(d[2]),m=a.match(new RegExp("a\x3dssrc:"+d[1]+" cname:(.*)\r?\n"))[1],k=a.match(new RegExp("a\x3dssrc:"+d[1]+" msid:(.*)\r?\n"))[1],n=a.match(new RegExp("a\x3dssrc:"+d[1]+" mslabel:(.*)\r?\n"))[1],l=a.match(new RegExp("a\x3dssrc:"+d[1]+" label:(.*)\r?\n"))[1];a.match(new RegExp("a\x3dssrc:"+
d[1]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});a.match(new RegExp("a\x3dssrc:"+d[2]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});for(var F=[f],H=[g],E=1;E<e;E++)F.push(f+1E3*E),H.push(g+1E3*E);e=c(F);for(var A in F)f=F[A],g=H[A],e+="a\x3dssrc-group:FID "+f+" "+g+"\r\n";for(A in F)f=F[A],g=H[A],e+="a\x3dssrc:"+f+" cname:"+m+"\r\na\x3dssrc:"+f+" msid:"+k+"\r\na\x3dssrc:"+f+" mslabel:"+n+"\r\na\x3dssrc:"+f+" label:"+l+"\r\na\x3dssrc:"+g+" cname:"+m+"\r\na\x3dssrc:"+g+" msid:"+
k+"\r\na\x3dssrc:"+g+" mslabel:"+n+"\r\na\x3dssrc:"+g+" label:"+l+"\r\n";return a.replace(d[0],e+"a\x3dx-google-flag:conference\r\n")},k=function(a){if(b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var c=a.match(/m=video.*\r\n/);null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],d)}}b.audio&&b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],
d)));return a};a.close=function(){a.state="closed";a.peerConnection.close()};b.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a={sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid,candidate:a.candidate.candidate}):(L.Logger.info("Gathered all candidates. Sending END candidate"),a={sdpMLineIndex:-1,sdpMid:"end",candidate:"end"});b.remoteDescriptionSet?b.callback({type:"candidate",
candidate:a}):(b.localCandidates.push(a),L.Logger.info("Storing candidate: ",b.localCandidates.length,a))};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.target.iceConnectionState)};var d,l=function(a,c){a||(c.sdp=e(c.sdp));c.sdp=k(c.sdp);a=c.sdp;var f=a.match(/a=rtpmap:(.*)opus.*\r\n/);
null!==f&&(a=a.replace(f[0],f[0]+"a\x3drtcp-fb:"+f[1]+"nack\r\n"));c.sdp=a;c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.callback({type:c.type,sdp:c.sdp});d=c},n=function(c){c.sdp=k(c.sdp);b.callback({type:c.type,sdp:c.sdp});d=c;a.peerConnection.setLocalDescription(c)};a.updateSpec=function(c,e){if(c.maxVideoBW||c.maxAudioBW)c.maxVideoBW&&(L.Logger.debug("Maxvideo Requested:",c.maxVideoBW,"limit:",b.limitMaxVideoBW),c.maxVideoBW>b.limitMaxVideoBW&&(c.maxVideoBW=b.limitMaxVideoBW),b.maxVideoBW=
c.maxVideoBW,L.Logger.debug("Result",b.maxVideoBW)),c.maxAudioBW&&(c.maxAudioBW>b.limitMaxAudioBW&&(c.maxAudioBW=b.limitMaxAudioBW),b.maxAudioBW=c.maxAudioBW),d.sdp=k(d.sdp),c.Sdp||c.maxAudioBW?(L.Logger.debug("Updating with SDP renegotiation",b.maxVideoBW,b.maxAudioBW),(void 0).sdp=k((void 0).sdp),a.peerConnection.setRemoteDescription(void 0,function(){b.remoteDescriptionSet=!0;b.callback({type:"updatestream",sdp:d.sdp})})):(L.Logger.debug("Updating without SDP renegotiation, newVideoBW:",b.maxVideoBW,
"newAudioBW:",b.maxAudioBW),b.callback({type:"updatestream",sdp:d.sdp}));if(c.minVideoBW||void 0!==c.slideShowMode||void 0!==c.muteStream||void 0!==c.qualityLayer)L.Logger.debug("MinVideo Changed to ",c.minVideoBW),L.Logger.debug("SlideShowMode Changed to ",c.slideShowMode),L.Logger.debug("muteStream changed to ",c.muteStream),b.callback({type:"updatestream",config:c})};a.createOffer=function(b){a.peerConnection.createOffer(l.bind(null,b),f,b)};a.addStream=function(b){b?a.peerConnection.addStream(b):
L.Logger.error("nativeStack addStream : stream is not exist!")};a.removeStream=function(b){a.peerConnection.removeStream(b)};a.getStats=function(){return a.peerConnection.getStats()};b.remoteCandidates=[];b.remoteDescriptionSet=!1;a.processSignalingMessage=function(c){L.Logger.info("Process Signaling Message",c);if("offer"===c.type)c.sdp=k(c.sdp),a.peerConnection.setRemoteDescription(c.sdp,n,function(a){L.Logger.error("Error: ",a)});else if("answer"===c.type)L.Logger.info("Set remote and local description"),
L.Logger.debug("Remote Description",c.sdp),L.Logger.debug("Local Description",d.sdp),c.sdp=k(c.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){b.remoteDescriptionSet=!0;for(L.Logger.info("Candidates to be added: ",b.remoteCandidates.length,b.remoteCandidates);0<b.remoteCandidates.length;)a.peerConnection.addIceCandidate(b.remoteCandidates.shift());for(L.Logger.info("Local candidates to send:",b.localCandidates.length);0<b.localCandidates.length;)b.callback({type:"candidate",
candidate:b.localCandidates.shift()})});else if("candidate"===c.type)try{var e="object"===typeof c.candidate?c.candidate:JSON.parse(c.candidate);if("end"!==e.candidate){e.candidate=e.candidate.replace(/a=/g,"");e.sdpMLineIndex=parseInt(e.sdpMLineIndex);var f=new RTCIceCandidate(e);b.remoteDescriptionSet?a.peerConnection.addIceCandidate(f):b.remoteCandidates.push(f)}}catch(r){L.Logger.error("Error parsing candidate",c.candidate)}};return a};TK=TK||{};TK.sessionId=103;
TK.Connection=function(b){var a={};b.sessionId=TK.sessionId+=1;a.browser=TK.getBrowser();if("fake"===a.browser)L.Logger.warning("[tk-sdk]Publish/subscribe video/audio streams not supported in erizofc yet"),a=TK.FcStack(b);else if("mozilla"===a.browser)L.Logger.debug("[tk-sdk]Firefox Stack"),a=TK.FirefoxStack(b);else if("bowser"===a.browser)L.Logger.debug("[tk-sdk]Bowser Stack"),a=TK.BowserStack(b);else if("chrome-stable"===a.browser||"electron"===a.browser)L.Logger.debug("[tk-sdk]Chrome Stable Stack"),a=
TK.TkChromeStableStack(b);else throw L.Logger.error("[tk-sdk]No stack available for this browser"),"WebRTC stack not available";null!==TK.end_type&&void 0!==TK.end_type&&1===TK.end_type&&(L.Logger.debug("Talk-Client Stack"),a=TK.TkNativeStack(b));a.updateSpec||(a.updateSpec=function(a,b){L.Logger.error("[tk-sdk]Update Configuration not implemented in this browser");b&&b("unimplemented")});return a};
TK.getBrowser=function(){var b="none";"undefined"!==typeof module&&module.exports?b="fake":null!==window.navigator.userAgent.match("Firefox")?b="mozilla":null!==window.navigator.userAgent.match("Bowser")?b="bowser":null!==window.navigator.userAgent.match("Chrome")?(b="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(b="electron")):null!==window.navigator.userAgent.match("Safari")?b="bowser":null!==window.navigator.userAgent.match("AppleWebKit")&&(b="bowser");return b};TK=TK||{};
TK.Stream=function(b){var a=TK.EventDispatcher(b);a.stream=b.stream;a.url=b.url;a.recording=b.recording;a.room=void 0;a.playing=!1;a.local=!1;a.video=b.video;a.audio=b.audio;a.screen=b.screen;a.videoSize=b.videoSize;a.videoFrameRate=b.videoFrameRate;a.extensionId=b.extensionId;a.desktopStreamId=b.desktopStreamId;a.videoMuted=!1;a.audioMuted=!1;a.attributes=b.attributes;if(!(void 0===a.videoSize||a.videoSize instanceof Array&&4===a.videoSize.length))throw Error("Invalid Video Size");if(void 0===b.local||
!0===b.local)a.local=!0;a.getID=function(){return a.local&&!b.streamID?"local":b.streamID};a.getAttributes=function(){return b.attributes};a.setAttributes=function(){L.Logger.error("[tk-sdk]Failed to set attributes data. This Stream object has not been published.")};a.updateLocalAttributes=function(a){if(a&&"object"===typeof a)for(var c in a)b.attributes[c]=a[c]};a.hasAudio=function(){return b.audio};a.hasVideo=function(){return b.video};a.hasData=function(){return b.data};a.hasScreen=function(){return b.screen};
a.sendData=function(){L.Logger.error("[tk-sdk]Failed to send data. This Stream object has not that channel enabled.")};a.init=function(){try{if((b.audio||b.video||b.screen)&&void 0===b.url){L.Logger.info("[tk-sdk]Requested access to local media");var c=b.video;!0===c||!0===b.screen?(c=!0===c?{}:c,void 0!==a.videoSize&&(c.mandatory=c.mandatory||{},c.mandatory.minWidth=a.videoSize[0],c.mandatory.minHeight=a.videoSize[1],c.mandatory.maxWidth=a.videoSize[2],c.mandatory.maxHeight=a.videoSize[3]),void 0!==
a.videoFrameRate&&(c.optional=c.optional||[],c.optional.push({minFrameRate:a.videoFrameRate[0]}),c.optional.push({maxFrameRate:a.videoFrameRate[1]}))):!0===b.screen&&void 0===c&&(c=!0);TK.AVMgr.getUserMedia(function(b){L.Logger.info("[tk-sdk]User has granted access to local media.");a.stream=b;e=TK.StreamEvent({type:"access-accepted"});a.dispatchEvent(e);a.stream.getTracks().forEach(function(b){b.onended=function(){a.stream.getTracks().forEach(function(a){a.onended=null});e=TK.StreamEvent({type:"stream-ended",
stream:a,msg:b.kind});a.dispatchEvent(e)}})},function(b){L.Logger.error("[tk-sdk]Failed to get access to local media. Error name was "+b.name+".",b);b=TK.StreamEvent({type:"access-denied",msg:b});a.dispatchEvent(b)},{video:c,audio:b.audio,fake:b.fake,screen:b.screen,extensionId:a.extensionId,desktopStreamId:a.desktopStreamId})}else{var e=TK.StreamEvent({type:"access-accepted"});a.dispatchEvent(e)}}catch(k){L.Logger.error("[tk-sdk]Failed to get access to local media. Error was "+k+"."),e=TK.StreamEvent({type:"access-denied",
msg:k}),a.dispatchEvent(e)}};a.close=function(){a.local&&(void 0!==a.room&&a.room.unpublish(a),a.hide(),void 0!==a.stream&&a.stream.getTracks().forEach(function(a){a.onended=null;a.stop()}),a.stream=void 0)};a.play=function(b,e){e=e||{};a.elementID=b;void 0!==b&&(b=new TK.VideoPlayer({id:a.getID(),stream:a,elementID:b,options:e}),a.player=b,a.playing=!0)};a.stop=function(){a.playing&&void 0!==a.player&&(a.player.destroy(),a.playing=!1)};a.show=function(){void 0!==a.player&&a.player.showVideo()};a.hide=
function(){void 0!==a.player&&a.player.hideVideo()};var g=function(){if(void 0!==a.player&&void 0!==a.stream){var b=a.player.video,e=document.defaultView.getComputedStyle(b),f=parseInt(e.getPropertyValue("width"),10),d=parseInt(e.getPropertyValue("height"),10),g=parseInt(e.getPropertyValue("left"),10);e=parseInt(e.getPropertyValue("top"),10);var n="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID);var m=document.defaultView.getComputedStyle(n);
n=parseInt(m.getPropertyValue("width"),10);m=parseInt(m.getPropertyValue("height"),10);var h=document.createElement("canvas");h.id="testing";h.width=n;h.height=m;h.setAttribute("style","display: none");h.getContext("2d").drawImage(b,g,e,f,d);return h}return null};a.getVideoFrameURL=function(a){var b=g();return null!==b?a?b.toDataURL(a):b.toDataURL():null};a.getVideoFrame=function(){var a=g();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};a.checkOptions=function(b,e){if(!0===
e){if(b.video||b.audio||b.screen)L.Logger.warning("[tk-sdk]Cannot update type of subscription"),b.video=void 0,b.audio=void 0,b.screen=void 0}else!1===a.local&&(!0===b.video&&!1===a.hasVideo()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to video when there is no video, won't subscribe to video"),b.video=!1),!0===b.audio&&!1===a.hasAudio()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to audio when there is no audio, won't subscribe to audio"),b.audio=!1));!1!==a.local||a.hasVideo()||!0!==b.slideShowMode||
(L.Logger.warning("[tk-sdk]Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),b.slideShowMode=!1)};a.updateMuteToServer=function(b){if(a.room&&a.room.p2p)L.Logger.warning("[tk-sdk]muteAudio is not implemented in p2p streams"),b("error");else if(void 0!==a.pc){var c={muteStream:{video:a.videoMuted,audio:a.audioMuted}};a.checkOptions(c,!0);a.pc.updateSpec(c,b)}};a._setQualityLayer=function(b,e,f){a.room&&a.room.p2p?(L.Logger.warning("[tk-sdk]setQualityLayer is not implemented in p2p streams"),
f("error")):(b={qualityLayer:{spatialLayer:b,temporalLayer:e}},a.checkOptions(b,!0),a.pc.updateSpec(b,f))};var f=function(b,e,f){!0!==e&&(e=!1);b="string"===typeof b?[b]:b;b=b instanceof Array?b:[];0<b.length&&a.room.sendControlMessage(a,"control",{name:"controlhandlers",enable:f,publisherSide:e,handlers:b})};a.disableHandlers=function(a,b){f(a,b,!1)};a.enableHandlers=function(a,b){f(a,b,!0)};a.updateConfiguration=function(b,e){if(void 0!==b)if(a.pc)if(a.checkOptions(b,!0),a.local)if(a.room.p2p)for(var c in a.pc)a.pc[c].updateSpec(b,
e);else a.pc.updateSpec(b,e);else a.pc.updateSpec(b,e);else e("This stream has no peerConnection attached, ignoring")};a.muteVideo=function(b,e){a.videoMuted!=b&&(a.videoMuted=b,void 0!==a.stream?(a.stream.getTracks().forEach(function(a){"video"===a.kind&&(a.enabled=!b)}),a.updateMuteToServer(e)):L.Logger.warning("[tk-sdk]not deviceStream to muteVideo"))};a.muteAudio=function(b,e){a.audioMuted!=b&&(a.audioMuted=b,void 0!==a.stream?(a.stream.getTracks().forEach(function(a){"audio"===a.kind&&(a.enabled=
!b)}),a.updateMuteToServer(e)):L.Logger.warning("[tk-sdk]not deviceStream to muteVideo"))};return a};TK=TK||{};
TK.NativeStream=function(b){var a=TK.EventDispatcher(b);a.stream=b.stream;a.url=b.url;a.recording=b.recording;a.room=void 0;a.playing=!1;a.local=!1;a.video=b.video;a.audio=b.audio;a.screen=b.screen;a.videoSize=b.videoSize;a.videoFrameRate=b.videoFrameRate;a.extensionId=b.extensionId;a.desktopStreamId=b.desktopStreamId;a.videoMuted=!1;a.audioMuted=!1;if(!(void 0===a.videoSize||a.videoSize instanceof Array&&4===a.videoSize.length))throw Error("Invalid Video Size");if(void 0===b.local||!0===b.local)a.local=
!0;a.getID=function(){return a.local&&!b.streamID?"local":b.streamID};a.getAttributes=function(){return b.attributes};a.setAttributes=function(){L.Logger.error("Failed to set attributes data. This Stream object has not been published.")};a.updateLocalAttributes=function(a){if(a&&"object"===typeof a)for(var c in a)b.attributes[c]=a[c]};a.hasAudio=function(){return b.audio};a.hasVideo=function(){return b.video};a.hasData=function(){return b.data};a.hasScreen=function(){return b.screen};a.sendData=function(){L.Logger.error("Failed to send data. This Stream object has not that channel enabled.")};
a.init=function(){try{if((b.audio||b.video||b.screen)&&void 0===b.url){L.Logger.info("Requested access to local media");var c=b.video;!0===c||!0===b.screen?(c=!0===c?{}:c,void 0!==a.videoSize&&(c.mandatory=c.mandatory||{},c.mandatory.minWidth=a.videoSize[0],c.mandatory.minHeight=a.videoSize[1],c.mandatory.maxWidth=a.videoSize[2],c.mandatory.maxHeight=a.videoSize[3]),void 0!==a.videoFrameRate&&(c.optional=c.optional||[],c.optional.push({minFrameRate:a.videoFrameRate[0]}),c.optional.push({maxFrameRate:a.videoFrameRate[1]}))):
!0===b.screen&&void 0===c&&(c=!0);TK.AVMgr.getUserMedia(function(b){L.Logger.info("User has granted access to local media.");a.stream=b;e=TK.StreamEvent({type:"access-accepted"});a.dispatchEvent(e)},function(b){L.Logger.error("Failed to get access to local media. Error name was "+b.name+".",b);b=TK.StreamEvent({type:"access-denied",msg:b});a.dispatchEvent(b)},{video:c,audio:b.audio,fake:b.fake,screen:b.screen,extensionId:a.extensionId,desktopStreamId:a.desktopStreamId})}else{var e=TK.StreamEvent({type:"access-accepted"});
a.dispatchEvent(e)}}catch(k){L.Logger.error("Failed to get access to local media. Error was "+k+"."),e=TK.StreamEvent({type:"access-denied",msg:k}),a.dispatchEvent(e)}};a.close=function(){a.local&&(void 0!==a.room&&a.room.unpublish(a),a.hide(),a.stream=void 0)};a.play=function(b,e){e=e||{};a.elementID=b;void 0!==b&&(b=new TK.NativeVideoPlayer({id:a.getID(),stream:a,elementID:b,options:e}),a.player=b,a.playing=!0,a.local?tknative.postMessage({command:"playStream",connectionId:a.getID().toString(),
isLocal:!0}):tknative.postMessage({command:"playStream",connectionId:a.getID().toString(),isLocal:!1}))};a.stop=function(){a.playing&&(void 0!==a.player&&(a.player.destroy(),a.playing=!1),a.local?tknative.postMessage({command:"stopStream",connectionId:a.getID().toString(),isLocal:!0}):tknative.postMessage({command:"stopStream",connectionId:a.getID().toString(),isLocal:!1}))};a.show=function(){void 0!==a.player&&a.player.showVideo()};a.hide=function(){void 0!==a.player&&a.player.hideVideo()};var g=
function(){if(void 0!==a.player&&void 0!==a.stream){var b=a.player.video,e=document.defaultView.getComputedStyle(b),f=parseInt(e.getPropertyValue("width"),10),d=parseInt(e.getPropertyValue("height"),10),g=parseInt(e.getPropertyValue("left"),10);e=parseInt(e.getPropertyValue("top"),10);var n="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID);var m=document.defaultView.getComputedStyle(n);n=parseInt(m.getPropertyValue("width"),
10);m=parseInt(m.getPropertyValue("height"),10);var h=document.createElement("canvas");h.id="testing";h.width=n;h.height=m;h.setAttribute("style","display: none");h.getContext("2d").drawImage(b,g,e,f,d);return h}return null};a.getVideoFrameURL=function(a){var b=g();return null!==b?a?b.toDataURL(a):b.toDataURL():null};a.getVideoFrame=function(){var a=g();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};a.checkOptions=function(b,e){if(!0===e){if(b.video||b.audio||b.screen)L.Logger.warning("Cannot update type of subscription"),
b.video=void 0,b.audio=void 0,b.screen=void 0}else!1===a.local&&(!0===b.video&&!1===a.hasVideo()&&(L.Logger.warning("Trying to subscribe to video when there is no video, won't subscribe to video"),b.video=!1),!0===b.audio&&!1===a.hasAudio()&&(L.Logger.warning("Trying to subscribe to audio when there is no audio, won't subscribe to audio"),b.audio=!1));!1!==a.local||a.hasVideo()||!0!==b.slideShowMode||(L.Logger.warning("Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),
b.slideShowMode=!1)};a.updateMuteToServer=function(b){if(a.room&&a.room.p2p)L.Logger.warning("muteAudio is not implemented in p2p streams"),b("error");else if(void 0!==a.pc){var c={muteStream:{video:a.videoMuted,audio:a.audioMuted}};a.checkOptions(c,!0);a.pc.updateSpec(c,b)}};a._setQualityLayer=function(b,e,f){a.room&&a.room.p2p?(L.Logger.warning("setQualityLayer is not implemented in p2p streams"),f("error")):(b={qualityLayer:{spatialLayer:b,temporalLayer:e}},a.checkOptions(b,!0),a.pc.updateSpec(b,
f))};var f=function(b,e,f){!0!==e&&(e=!1);b="string"===typeof b?[b]:b;b=b instanceof Array?b:[];0<b.length&&a.room.sendControlMessage(a,"control",{name:"controlhandlers",enable:f,publisherSide:e,handlers:b})};a.disableHandlers=function(a,b){f(a,b,!1)};a.enableHandlers=function(a,b){f(a,b,!0)};a.updateConfiguration=function(b,e){if(void 0!==b)if(a.pc)if(a.checkOptions(b,!0),a.local)if(a.room.p2p)for(var c in a.pc)a.pc[c].updateSpec(b,e);else a.pc.updateSpec(b,e);else a.pc.updateSpec(b,e);else e("This stream has no peerConnection attached, ignoring")};
a.muteVideo=function(b,e){a.videoMuted!=b&&(a.videoMuted=b,tknative.postMessage({command:"enableVideo",enable:!b}),void 0!==a.stream?a.updateMuteToServer(e):L.Logger.warning("not deviceStream to muteVideo"))};a.muteAudio=function(b,e){a.audioMuted!=b&&(a.audioMuted=b,tknative.postMessage({command:"enableAudio",enable:!b}),void 0!==a.stream?a.updateMuteToServer(e):L.Logger.warning("not deviceStream to muteVideo"))};return a};TK=TK||{};var tknative;TK.Initialize=function(b,a){b&&1===a&&(tknative=tknative||TK.nativeEntry(),TK.end_type=a,TK.AVMgr=null,TK.AVMgr=TK.NativeAVMgr(),TK.Stream=TK.NativeStream,TK.VideoPlayer=TK.NativeVideoPlayer)};
TK.Room=function(){function b(b,c,d){b=b||p.publishstate;c=c||{hasvideo:p.hasvideo,disablevideo:p.disablevideo};d=d||{hasaudio:p.hasaudio,disableaudio:p.disableaudio};g(c.hasvideo&&!c.disablevideo&&(b===TK.PUBLISH_STATE_VIDEOONLY||b===TK.PUBLISH_STATE_BOTH));a(d.hasaudio&&!d.disableaudio&&(b===TK.PUBLISH_STATE_AUDIOONLY||b===TK.PUBLISH_STATE_BOTH))}function a(a){v.muteAudio(!a,function(a){if(void 0!==v.getID()||"local"!==v.getID())L.Logger.debug("[tk-sdk]Sending message",a),a=c(a),J("signaling_message",
{streamId:v.getID(),msg:a})})}function g(a){v.muteVideo(!a,function(a){if(void 0!==v.getID()||"local"!==v.getID())L.Logger.debug("[tk-sdk]Sending message",a),a=c(a),J("signaling_message",{streamId:v.getID(),msg:a})})}function f(){var a;for(a in d.remoteStreams)if(d.remoteStreams.hasOwnProperty(a)){var b=d.remoteStreams[a];R(b);delete d.remoteStreams[a];b&&!b.failed&&(b=TK.StreamEvent({type:"stream-removed",stream:b}),d.dispatchEvent(b))}d.remoteStreams={};for(a in d.localStreams)if(d.localStreams.hasOwnProperty(a)){b=
d.localStreams[a];if(d.p2p)for(var c in b.pc)b.pc[c].close();else b.pc.close();delete d.localStreams[a]}void 0!=B&&(Y(C),Z(B));null!=p&&(p.publishstate=TK.PUBLISH_STATE_NONE)}function c(a){if(!Q)return a;if("offer"===a.type||"candidate"===a.type){var b=JSON.stringify(a),c=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;c.test(b)&&(a=JSON.parse(b.replace(c,"254.254.254.254")))}return a}function e(a,b){var c=!1,d=0,e=d=0,f=0,g=0,M=0,h=0,n=0,k=0,m=0,l=0,O=
{frameWidth:0,frameHeight:0},q=0,r=0,t=0,p=0,w=0;var u=a.getID()!==v.getID();b.forEach(function(a,b){"outbound-rtp"===a.type&&"video"===a.mediaType&&(l=a.timestamp,f=a.packetsSent,e=a.bytesSent,m=a.nackCount);"inbound-rtp"===a.type&&"video"===a.mediaType&&(l=a.timestamp,p=a.packetsReceived,t=a.bytesReceived,r=a.packetsLost);"track"===a.type&&"video"===a.kind&&(l=a.timestamp,n=a.frameWidth,k=a.frameHeight,M=a.framesSent,h=a.framesReceived);"candidate-pair"===a.type&&(l=a.timestamp,w=a.currentRoundTripTime)});
a.report||(a.report={},c=!0);a.report.timestamp=a.report.timestamp||l;u?(a.report.bytesReceived=a.report.bytesReceived||t,a.report.framesReceived=a.report.framesReceived||h):(a.report.bytesSent=a.report.bytesSent||e,a.report.framesSent=a.report.framesSent||M);if(!c)return u?(d=8*(t-a.report.bytesReceived),g=(h-a.report.framesReceived)/((l-a.report.timestamp)/1E3),q=p?r/p:0):(d=8*(e-a.report.bytesSent),g=(M-a.report.framesSent)/((l-a.report.timestamp)/1E3),q=f?m/f:0),d=d/((l-a.report.timestamp)/1E3)/
1024,O.frameWidth=isNaN(n)?0:n,O.frameHeight=isNaN(k)?0:k,a.report.timestamp=l,u?(a.report.bytesReceived=t,a.report.framesReceived=h):(a.report.bytesSent=e,a.report.framesSent=M),{kbps:isNaN(d)?0:Math.round(d),frameRatio:O,frameRate:isNaN(g)?0:Math.round(g),packetsLost:isNaN(q)?0:Math.ceil(100*q),rtt:isNaN(w)?0:Math.round(1E3*w)}}var k={},d=TK.EventDispatcher(k),l,n,m,h,q=0,r,t,w=320,I=240,u=15,z=256,F=6,H,E,A,v,p={},P,Q=!1,W=window.location.hostname,D=!1,X=!0,S=void 0,T=3E3,N=!1,U;d.remoteStreams=
{};d.localStreams={};d.roomID="";d.socket={};d.p2p=!1;d.state=0;var B={},C={},aa=[[176,144],[320,240],[640,480],[1280,720],[1920,1080]],y=0,x;var R=function(a){void 0!==a.stream&&(a.hide(),a.pc&&(a.pc.close(),delete a.pc),a.local&&a.stream.stop(),delete a.stream)};var ba=function(a,b){a.local?G("sendDataStream",{id:a.getID(),msg:b}):L.Logger.error("[tk-sdk]You can not send data through a remote stream")};var ca=function(a,b){a.local?(a.updateLocalAttributes(b),G("updateStreamAttributes",{id:a.getID(),
attrs:b})):L.Logger.error("[tk-sdk]You can not update attributes in a remote stream")};var fa=function(a,b,e){var f=function(a,b){a.pc=TK.Connection({callback:function(d){d=c(d);J("signaling_message",{streamId:a.getID(),peerSocket:b,msg:d})},iceServers:d.iceServers,maxAudioBW:k.maxAudioBW,maxVideoBW:k.maxVideoBW,limitMaxAudioBW:k.maxAudioBW,limitMaxVideoBW:k.maxVideoBW,cnnId:a.getID()});a.pc.onaddstream=function(b){L.Logger.info("[tk-sdk]Stream subscribed");a.stream=b.stream;N&&d.rtcStatsrObserver(a);
b=TK.StreamEvent({type:"stream-subscribed",stream:a});d.dispatchEvent(b)}};d.state=1;d.socket=io.connect(m,{secure:!0,reconnection:!0,transports:["websocket"]});d.socket.on("connect",function(){L.Logger.debug("[tk-sdk]tk connectd");d.state=2;K(4);if(d.firstConnect){var a=TK.RoomEvent({type:"room-reconnected"});d.dispatchEvent(a)}else d.socket.on("onAddStream",function(a){var b=TK.Stream({streamID:a.id,local:!1,audio:a.audio,video:a.video,data:a.data,screen:a.screen,attributes:a.attributes,extensionId:a.extensionId});
b.room=d;d.remoteStreams[a.id]=b;(a.extensionId!==p.id||void 0!==a.attributes&&void 0!==a.attributes.duration)&&d.subscribe(b);N&&a.extensionId===p.id&&d.rtcStatsrObserver(b);a=TK.StreamEvent({type:"stream-added",stream:b});d.dispatchEvent(a)}),d.socket.on("signaling_message_mediaserver",function(a){L.Logger.debug("[tk-sdk]signaling_message_mediaserver",a);var b=a.mess;if(Q&&"answer"===b.type){var c=JSON.stringify(b),e=W,f=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;
f.test(c)&&(b=JSON.parse(c.replace(f,e)))}a.mess=b;(b=a.peerId?d.remoteStreams[a.peerId]:d.localStreams[a.streamId])&&!b.failed&&b.pc.processSignalingMessage(a.mess)}),d.socket.on("signaling_message_peer",function(a){var b=d.localStreams[a.streamId];b&&!b.failed?b.pc[a.peerSocket].processSignalingMessage(a.msg):(b=d.remoteStreams[a.streamId],b.pc||f(b,a.peerSocket),b.pc.processSignalingMessage(a.msg))}),d.socket.on("publish_me",function(a){var b=d.localStreams[a.streamId];void 0===b.pc&&(b.pc={});
b.pc[a.peerSocket]=TK.Connection({callback:function(b){b=c(b);J("signaling_message",{streamId:a.streamId,peerSocket:a.peerSocket,msg:b})},audio:b.hasAudio(),video:b.hasVideo(),iceServers:d.iceServers,cnnId:a.streamId});b.pc[a.peerSocket].oniceconnectionstatechange=function(c){"failed"===c&&(b.pc[a.peerSocket].close(),delete b.pc[a.peerSocket])};b.pc[a.peerSocket].addStream(b.stream);b.pc[a.peerSocket].createOffer()}),d.socket.on("onBandwidthAlert",function(a){L.Logger.info("[tk-sdk]Bandwidth Alert on",
a.streamID,"message",a.message,"BW:",a.bandwidth);if(a.streamID){var b=d.remoteStreams[a.streamID];b&&!b.failed&&(a=TK.StreamEvent({type:"bandwidth-alert",stream:b,message:a.message,bandwidth:a.bandwidth}),d.dispatchEvent(a))}}),d.socket.on("onDataStream",function(a){a=TK.StreamEvent({type:"stream-data",message:a.msg,stream:d.remoteStreams[a.id]});d.dispatchEvent(a)}),d.socket.on("onUpdateAttributeStream",function(a){var b=d.remoteStreams[a.id],c=TK.StreamEvent({type:"stream-attributes-update",attrs:a.attrs,
stream:b});void 0!==b?(b.updateLocalAttributes(a.attrs),d.dispatchEvent(c)):L.Logger.warning("[tk-sdk]onUpdateAttributeStream stream invalid",a)}),d.socket.on("onRemoveStream",function(a){var b=d.localStreams[a.id];b&&!b.failed?(b.failed=!0,b.extensionId===p.id&&d.changeUserProperty(b.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE}),L.Logger.warning("[tk-sdk]We received a removeStream from our own stream -- probably timed out",a),a=TK.StreamEvent({type:"stream-failed",message:{reason:"Publishing local stream failed because of an TK Error",
source:"onRemoveStream"},stream:b}),d.dispatchEvent(a)):(b=d.remoteStreams[a.id])&&b.failed?L.Logger.debug("[tk-sdk]Received onRemoveStream for a stream that we already marked as failed ",a.id):b?(delete d.remoteStreams[a.id],R(b),a=TK.StreamEvent({type:"stream-removed",stream:b}),d.dispatchEvent(a)):L.Logger.debug("[tk-sdk]Received a removeStream for",a.id,"and it has not been registered here, ignoring.")}),d.socket.on("disconnect",function(a){L.Logger.info("[tk-sdk]Socket disconnected, lost connection to TKController",
a);0!==d.state&&(K(8),d.state=0,N&&d.stopIntervalRtcStatsrObserver(),v.rtcStatsrObserverTimer&&d.stopIntervalRtcStatsrObserverByStream(v),a=TK.RoomEvent({type:"room-disconnected",message:"unexpected-disconnection"}),d.dispatchEvent(a))}),d.socket.on("connection_failed",function(a){L.Logger.info("[tk-sdk]Socket connection_failed");if("publish"===a.type){if(L.Logger.error("[tk-sdk]ICE Connection Failed on publishing stream",a.streamId,d.state),0!==d.state&&a.streamId&&(a=d.localStreams[a.streamId])&&
!a.failed){a.failed=!0;a.extensionId===p.id&&d.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE});var b=TK.StreamEvent({type:"stream-failed",message:{reason:"Publishing local stream failed ICE Checks",source:"connection_failed"},stream:a});d.dispatchEvent(b)}}else L.Logger.error("[tk-sdk]ICE Connection Failed on subscribe stream",a.streamId),0!==d.state&&a.streamId&&(a=d.remoteStreams[a.streamId])&&!a.failed&&(a.failed=!0,b=TK.StreamEvent({type:"stream-failed",message:{reason:"Subscriber failed ICE, cannot reach Talk for media",
source:"connection_failed"},stream:a}),d.dispatchEvent(b),d.unsubscribe(a))}),d.socket.on("error",function(a){L.Logger.error("[tk-sdk]Cannot connect to Controller");e&&e("Cannot connect to TKController (socket.io error)",a)}),d.socket.on("reconnecting",function(a){L.Logger.info("[tk-sdk]reconnecting info:",a);a=TK.RoomEvent({type:"room-reconnecting",message:{number:a,info:"room-reconnecting number:"+a}});d.dispatchEvent(a)}),d.socket.on("participantLeft",function(a){var b=B[a],c=TK.RoomEvent({type:"room-participant_leave",
user:b});d.dispatchEvent(c);C[b.role]||(C[b.role]={});delete C[b.role][a];delete B[a]}),d.socket.on("participantJoined",function(a){L.Logger.info("[tk-sdk]participantJoined",a);var b=TK.RoomUser(a);void 0!==b&&(C[b.role]||(C[b.role]={}),C[b.role][b.id]=b,B[b.id]=b,D&&(b.joinTs=a.ts),a=TK.RoomEvent({type:"room-participant_join",user:b}),d.dispatchEvent(a))}),d.socket.on("participantEvicted",function(){d.leaveroom(!0);var a=TK.RoomEvent({type:"room-participant_evicted"});d.dispatchEvent(a)}),d.socket.on("sendMessage",
function(a){L.Logger.info("[tk-sdk]room-text-message info:"+(a&&"object"===typeof a?JSON.stringify(a):a));if(a&&a.hasOwnProperty("message")){var b=p;void 0!==a.fromID&&(b=B[a.fromID]);if(b){if(D){var c=!1;a&&a.message&&"string"===typeof a.message&&(a.message=JSON.parse(a.message),c=!0);a.message.ts=a.ts;c&&"object"===typeof a.message&&(a.message=JSON.stringify(a.message))}a=TK.RoomEvent({type:"room-text-message",user:b,message:a.message});d.dispatchEvent(a)}else L.Logger.error("[tk-sdk]user is not exist , user id:"+
a.fromID+", message from room-text-message!")}else L.Logger.error("messages or messages.message is not exist!")}),d.socket.on("msgList",function(a){L.Logger.info("[tk-sdk]msgList info:",a);a=TK.RoomEvent({type:"room-msglist",message:a});d.dispatchEvent(a)}),d.socket.on("pubMsg",function(a){L.Logger.info("[tk-sdk]pubMsg info:",a);a=TK.RoomEvent({type:"room-pubmsg",message:a});d.dispatchEvent(a)}),d.socket.on("delMsg",function(a){L.Logger.info("[tk-sdk]delMsg info:",a);a=TK.RoomEvent({type:"room-delmsg",
message:a});d.dispatchEvent(a)}),d.socket.on("setProperty",function(a){L.Logger.info("[tk-sdk]setProperty info:",a);var b=a.id;if(a.hasOwnProperty("properties")){a=a.properties;var c=B[b];if(p.id==b)if(c=p,a.hasOwnProperty("publishstate"))d.onChangeMyPublishState(a.publishstate);else if(a.hasOwnProperty("disablevideo"))d.onChangeMyDisableVideoState(a.disablevideo);else if(a.hasOwnProperty("disableaudio"))d.onChangeMyDisableAudioState(a.disableaudio);if(void 0!==c){for(var e in a)"id"!=e&&"watchStatus"!=
e&&(c[e]=a[e]);b=TK.RoomEvent({type:"room-userproperty-changed",user:c,message:a});d.dispatchEvent(b)}}}),d.socket.on("playback_clearAll",function(){if(D){var a=TK.RoomEvent({type:"room-playback-clear_all"});d.dispatchEvent(a)}else L.Logger.warning("[tk-sdk]No playback environment!")}),d.socket.on("duration",function(a){D?(a=TK.RoomEvent({type:"room-playback-duration",message:a}),d.dispatchEvent(a)):L.Logger.warning("[tk-sdk]No playback environment!")}),d.socket.on("playbackEnd",function(){if(D){var a=
TK.RoomEvent({type:"room-playback-playbackEnd"});d.dispatchEvent(a)}else L.Logger.warning("[tk-sdk]No playback environment!")}),d.socket.on("playback_updatetime",function(a){D?(a=TK.RoomEvent({type:"room-playback-playback_updatetime",message:a}),d.dispatchEvent(a)):L.Logger.warning("[tk-sdk]No playback environment!")}),d.firstConnect=!0;ea(b,e)})};var G=function(a,b,c,e){L.Logger.debug("[tk-sdk]sendMessageSocket",a,b);d.socket.emit(a,b,function(a,d){"success"===a?(L.Logger.debug("[tk-sdk]sendMessageSocket success",
b,d),c&&c(d)):"error"===a?e&&e(d):c&&c(a,d)})};var J=function(a,b,c,e){0!==d.state?d.socket.emit(a,b,c,function(a,b){e&&e(a,b)}):L.Logger.warning("[tk-sdk]Trying to send a message over a disconnected Socket")};d.setIsGetFileList=function(a){X=a};d.getRoomType=function(){return q};d.getRoomName=function(){return r};d.getRoomProperties=function(){return t};d.getMySelf=function(){return p};d.getUser=function(a){if(void 0!==a)return B[a]};d.getUsers=function(){return B};d.getSpecifyRoleList=function(a){if(void 0!==
a)return C[a]||{}};d.getAllRoleList=function(){return C};d.getConfigInfo=function(){return H};d.getPublishStreamNumber=function(){var a=0,b;for(b in B)B[b].publishstate!==TK.PUBLISH_STATE_NONE&&a++;return a};d.isBeyondMaxVideo=function(){var a=0,b;for(b in B)if(B[b].publishstate!==TK.PUBLISH_STATE_NONE&&++a>=F)return!0;return!1};d.changeUserProperty=function(a,b,c){if(6!=y)return 2;if(void 0===c)return 4;var d={};d.id=a;d.toID=b;if(B[a]){if(c&&"object"===typeof c)return d.properties=c,G("setProperty",
d),0;L.Logger.error("[tk-sdk]properties must be json , user id: "+a+"!")}else L.Logger.error("[tk-sdk]user is not exist , user id: "+a+"!")};d.onChangeMyPublishState=function(a){L.Logger.info("[tk-sdk]onChangeMyPublishState "+p.publishstate+" to "+a);p.publishstate!=a&&(a>TK.PUBLISH_STATE_NONE?(b(a),p.publishstate===TK.PUBLISH_STATE_NONE&&d.publish(v)):d.unpublish(v),p.publishstate=a)};d.onChangeMyDisableVideoState=function(a){L.Logger.info("[tk-sdk]onChangeMyDisableVideoState "+p.disablevideo+" to "+
a);p.disablevideo!=a&&(p.disablevideo=a,p.publishstate>TK.PUBLISH_STATE_NONE&&b())};d.onChangeMyDisableAudioState=function(a){L.Logger.info("[tk-sdk]onChangeMyDisableAudioState "+p.disableaudio+" to "+a);p.disableaudio!=a&&(p.disableaudio=a,p.publishstate>TK.PUBLISH_STATE_NONE&&b())};d.changeUserPublish=function(a,b){if(6!=y)return 2;if(void 0===a)return 4;if(a===p.id)d.onChangeMyPublishState(b);d.changeUserProperty(a,"__all",{publishstate:b});return 0};d.changeMyDisableVideoState=function(a){"boolean"!==
typeof a?L.Logger.warning("[tk-sdk]changeMyDisableVideoState:disablevideo must boolean !"):(d.onChangeMyDisableVideoState(a),d.changeUserProperty(p.id,"__all",{disablevideo:a}))};d.changeMyDisableAudioState=function(a){"boolean"!==typeof a?L.Logger.warning("[tk-sdk]changeMyDisableVideoState:disablevideo must boolean !"):(d.onChangeMyDisableAudioState(a),d.changeUserProperty(p.id,"__all",{disableaudio:a}))};d.sendMessage=function(a,b){if(6!=y)return 2;var c={};c.toID=b;c.message=a;G("sendMessage",
c);return 0};d.pubMsg=function(a,b,c,d,e,f){if(6!=y)return 2;var g={};g.name=a;g.id=b;g.toID=c;g.data=d;e||(g.do_not_save="");void 0!==f&&(g.expiresabs=f);G("pubMsg",g);return 0};d.delMsg=function(a,b,c,d){if(6!=y)return 2;var e={};e.name=a;e.id=b;e.toID=c;e.data=d;G("delMsg",e);return 0};d.evictUser=function(a){L.Logger.debug("[tk-sdk]evictUser",a);if(6!=y)return 2;var b={};b.id=a;G("evictParticipant",b);return 0};d.joinroom=function(a,b,c){0!==d.state&&L.Logger.warning("[tk-sdk]Room already connected",
this.state);if(1!==y||void 0===l||void 0===n||void 0===p)return L.Logger.warning("[tk-sdk]Status error ",y),-1;v=a;void 0===a?(p.hasvideo=!1,p.hasaudio=!1):(p.hasvideo=a.video,p.hasaudio=a.audio);E=b;A=c;L.Logger.info("[tk-sdk]joinroom",p);B={};C={};ha(l,n,function(a,b){0!==a&&L.Logger.info("[tk-sdk]step2GetConfig "+b);0==a&&2==y?ia(l,n,function(a,b){L.Logger.info("[tk-sdk]step2GetFileList "+a);-1!==a&&(void 0!==b?(U=b,a=TK.RoomEvent({type:"room-files",message:U})):(U=[],a=TK.RoomEvent({type:"room-error",
message:{source:L.Constant.roomError.GETFILELISTERROR,error:a}})),d.dispatchEvent(a));ja()}):(a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.GETCONFIGERROR,error:a}}),d.dispatchEvent(a))})};d.leaveroom=function(a){a=a||!1;L.Logger.debug("[tk-sdk]leaveroom:Disconnection requested");K(8);try{d.socket&&d.socket.disconnect&&d.socket.disconnect()}catch(O){L.Logger.debug("[tk-sdk]Socket already disconnected , disconnect errorInfo:",O)}d.socket=void 0;a=TK.RoomEvent({type:"room-leaveroom",
message:a});d.dispatchEvent(a)};d.publish=function(a,b,e){if(6!=y)return L.Logger.warning("[tk-sdk]publish with wrong room status",y),2;L.Logger.debug("[tk-sdk]calling publish",a);b=b||{};b.maxVideoBW=b.maxVideoBW||k.defaultVideoBW;b.maxVideoBW>k.maxVideoBW&&(b.maxVideoBW=k.maxVideoBW);void 0===b.minVideoBW&&(b.minVideoBW=0);b.minVideoBW>k.defaultVideoBW&&(b.minVideoBW=k.defaultVideoBW);b.simulcast=b.simulcast||b._simulcast||!1;a&&a.local&&!a.failed&&void 0===d.localStreams[a.getID()]?(a.hasAudio()||
a.hasVideo()||a.hasScreen())&&void 0===a.url&&void 0===a.recording&&(L.Logger.info("[tk-sdk]Publishing to ms Normally, is createOffer",b.createOffer,a.extensionId),J("publish",{state:"ms",data:a.hasData(),audio:a.hasAudio(),video:a.hasVideo(),screen:a.hasScreen(),minVideoBW:b.minVideoBW,attributes:a.getAttributes(),extensionId:a.extensionId,createOffer:b.createOffer,metadata:b.metadata,scheme:b.scheme},void 0,function(f,g){if(0!=f){L.Logger.error("[tk-sdk]Error when publishing the stream: ",f,g);
a.extensionId===p.id&&d.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE});var h=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{error:f,id:g,hasdata:!1}});d.dispatchEvent(h);e&&e(void 0,f)}else L.Logger.info("[tk-sdk]Stream assigned an Id, starting the publish process"),a.getID=function(){return g},a.hasData()&&(a.sendData=function(b){ba(a,b)}),a.setAttributes=function(b){ca(a,b)},d.localStreams[g]=a,a.room=d,a.pc=TK.Connection({callback:function(b){L.Logger.debug("[tk-sdk]Sending message",
b);b=c(b);J("signaling_message",{streamId:a.getID(),msg:b},void 0,function(){})},iceServers:d.iceServers,maxAudioBW:b.maxAudioBW,maxVideoBW:b.maxVideoBW,limitMaxAudioBW:k.maxAudioBW,limitMaxVideoBW:k.maxVideoBW,simulcast:b.simulcast,audio:a.hasAudio(),video:a.hasVideo(),cnnId:a.getID()}),a.pc.addStream(a.stream),a.pc.oniceconnectionstatechange=function(b){"failed"===b&&0!==d.state&&a&&!a.failed&&(a.failed=!0,a.extensionId===p.id&&d.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE}),
L.Logger.warning("[tk-sdk]Publishing Stream",a.getID(),"has failed after successful ICE checks"),b=TK.StreamEvent({type:"stream-failed",message:{reason:"Publishing stream failed after connection",source:"publish"},stream:a}),d.dispatchEvent(b))},b.createOffer||a.pc.createOffer(),e&&e(g)})):(L.Logger.error("[tk-sdk]Trying to publish invalid stream"),e&&e(void 0,"Invalid Stream"));return 0};d.publishMedia=function(a,b,c){if(6!=y)return L.Logger.warning("[tk-sdk]publish with wrong room status",y),2;
L.Logger.debug("[tk-sdk]calling mediaPublish stream");b=b||{};if(a&&!a.failed&&void 0===d.remoteStreams[a.getID()]){if(a.hasAudio()||a.hasVideo()||a.hasScreen())if(void 0!==a.url||void 0!==a.recording){if(a.url){var e="url";var f=a.url}else e="recording",f=a.recording;L.Logger.info("[tk-sdk]Checking publish options for",a.getID());a.checkOptions(b);J("publish",{state:e,data:a.hasData(),audio:a.hasAudio(),video:a.hasVideo(),attributes:a.getAttributes(),extensionId:a.extensionId,metadata:b.metadata,
createOffer:b.createOffer},f,function(b,e){if(0==b)L.Logger.info("[tk-sdk]mediaStream published"),a.getID=function(){return e},a.sendData=function(b){ba(a,b)},a.setAttributes=function(b){ca(a,b)},a.room=d,c&&c(e);else{L.Logger.error("[tk-sdk]Error when publishing mediaStream",b,e);var f=TK.StreamEvent({type:"stream-publish-fail",stream:a,message:{error:b,id:e,hasdata:!1}});d.dispatchEvent(f);c&&c(void 0,b)}})}}else L.Logger.error("[tk-sdk]Trying to publish invalid mediaStream",a),c&&c(void 0,"Invalid Stream");
return 0};d.startRecording=function(a,b){a?(L.Logger.debug("[tk-sdk]Start Recording stream: "+a.getID()),G("startRecorder",{to:a.getID()},function(a,c){null===a?(L.Logger.error("[tk-sdk]Error on start recording",c),b&&b(void 0,c)):(L.Logger.info("[tk-sdk]Start recording",a),b&&b(a))})):(L.Logger.error("[tk-sdk]Trying to start recording on an invalid stream",a),b&&b(void 0,"Invalid Stream"))};d.stopRecording=function(a,b){G("stopRecorder",{id:a},function(c,d){null===c?(L.Logger.error("[tk-sdk]Error on stop recording",
d),b&&b(void 0,d)):(L.Logger.info("[tk-sdk]Stop recording",a),b&&b(!0))})};d.unpublish=function(a,b){if(6!=y)return 2;if(a&&a.local)return G("unpublish",a.getID(),function(c,e){0!==c?(L.Logger.error("[tk-sdk]Error unpublishing stream",e),c=TK.StreamEvent({type:"stream-unpublish-fail",stream:a,message:{error:e}}),d.dispatchEvent(c),b&&b(void 0,e)):(a.failed&&delete a.failed,L.Logger.info("[tk-sdk]Stream unpublished , stream id:"+a.getID()),b&&b(!0))}),a.room=void 0,(a.hasAudio()||a.hasVideo()||a.hasScreen())&&
void 0===a.url&&(a.pc&&a.pc.close(),a.pc=void 0),delete d.localStreams[a.getID()],a.getID=function(){return"local"},a.sendData=function(){},a.setAttributes=function(){},0;L.Logger.error("[tk-sdk]unpublish error:","Cannot unpublish, stream does not exist or is not local");var c=TK.StreamEvent({type:"stream-unpublish-fail",stream:a,message:{error:"Cannot unpublish, stream does not exist or is not local"}});d.dispatchEvent(c);b&&b(void 0,"Cannot unpublish, stream does not exist or is not local")};d.unpublishMedia=
function(a,b){if(6!=y)return 2;G("unpublish",a.getID(),function(c,e){0!==c?(L.Logger.error("[tk-sdk]Error unpublishing stream",e),c=TK.StreamEvent({type:"stream-unpublish-fail",stream:a,message:{error:e}}),d.dispatchEvent(c),b&&b(void 0,e)):(a.failed&&delete a.failed,delete d.remoteStreams[a.getID()],L.Logger.info("[tk-sdk]meidaStream unpublished , stream id:"+a.getID()),b&&b(!0))})};d.sendControlMessage=function(a,b,c){a&&a.getID()&&(b={type:"control",action:c},J("signaling_message",{streamId:a.getID(),
msg:b}))};d.subscribe=function(a,b,e){if(6!=y)return L.Logger.warning("[tk-sdk]subscribe when not ready"),2;b=b||{};if(!a||a.local||a.failed){var f="Error on subscribe";a?a.local?(L.Logger.warning("[tk-sdk]Cannot subscribe to local stream, you should subscribe to the remote version of your local stream"),f="Local copy of stream"):a.failed&&(L.Logger.warning("[tk-sdk]Cannot subscribe to failed stream, you should wait a new stream-added event."),f="Failed stream"):(L.Logger.warning("[tk-sdk]Cannot subscribe to invalid stream",
a),f="Invalid or undefined stream");e&&e(void 0,f)}else{if(a.hasVideo()||a.hasAudio()||a.hasScreen())a.hasVideo()||a.hasScreen()||(b.video=!1),a.hasAudio()||(b.audio=!1),d.p2p?(J("subscribe",{streamId:a.getID(),metadata:b.metadata}),e&&e(!0)):(b.maxVideoBW=b.maxVideoBW||k.defaultVideoBW,b.maxVideoBW>k.maxVideoBW&&(b.maxVideoBW=k.maxVideoBW),L.Logger.info("[tk-sdk]Checking subscribe options for",a.getID()),a.checkOptions(b),J("subscribe",{streamId:a.getID(),audio:b.audio,video:b.video,data:b.data,
browser:TK.getBrowser(),createOffer:b.createOffer,metadata:b.metadata,slideShowMode:b.slideShowMode},void 0,function(f,g){0!==f?(L.Logger.error("[tk-sdk]Error subscribing to stream ",g),f=TK.StreamEvent({type:"stream-subscribe-fail",message:{error:g,stream:a,hasdata:!1}}),d.dispatchEvent(f),e&&e(void 0,g)):(L.Logger.info("[tk-sdk]Subscriber added"),a.pc=TK.Connection({callback:function(b){L.Logger.info("[tk-sdk]Sending message",b);b=c(b);J("signaling_message",{streamId:a.getID(),msg:b,browser:a.pc.browser},
void 0,function(){})},nop2p:!0,audio:b.audio,video:b.video,maxAudioBW:k.maxAudioBW,maxVideoBW:k.maxVideoBW,limitMaxAudioBW:k.maxAudioBW,limitMaxVideoBW:k.maxVideoBW,iceServers:d.iceServers,cnnId:a.getID()}),a.pc.onaddstream=function(b){L.Logger.info("[tk-sdk]Stream subscribed");a.stream=b.stream;N&&d.rtcStatsrObserver(a);b=TK.StreamEvent({type:"stream-subscribed",stream:a});d.dispatchEvent(b)},a.pc.oniceconnectionstatechange=function(b){"failed"===b&&0!==d.state&&a&&!a.failed&&(a.failed=!0,L.Logger.warning("[tk-sdk]Subscribing stream",
a.getID(),"has failed after successful ICE checks"),b=TK.StreamEvent({type:"stream-failed",message:{reason:"Subscribing stream failed after connection",source:"subscribe"},stream:a}),d.dispatchEvent(b),d.unsubscribe(a))},a.pc.createOffer(!0),e&&e(!0))}));else if(a.hasData()&&!1!==b.data)J("subscribe",{streamId:a.getID(),data:b.data,metadata:b.metadata},void 0,function(b,c){0!==b?(L.Logger.error("[tk-sdk]Error subscribing to stream ",c),b=TK.StreamEvent({type:"stream-subscribe-fail",stream:a,message:{error:c,
hasdata:!0}}),d.dispatchEvent(b),e&&e(void 0,c)):(L.Logger.info("[tk-sdk]Stream subscribed"),c=TK.StreamEvent({type:"stream-subscribed",stream:a}),d.dispatchEvent(c),e&&e(!0))});else{L.Logger.warning("[tk-sdk]There's nothing to subscribe to");e&&e(void 0,"Nothing to subscribe to");return}L.Logger.info("[tk-sdk]Subscribing to: "+a.getID());return 0}};d.unsubscribe=function(a,b){void 0!==d.socket&&a&&!a.local&&G("unsubscribe",a.getID(),function(c,e){0!==c?(c=TK.StreamEvent({type:"stream-unsubscribe-fail",
stream:a,message:{error:e}}),d.dispatchEvent(c),b&&b(void 0,e)):(R(a),b&&b(!0))},function(){L.Logger.error("[tk-sdk]Error calling unsubscribe.")})};d.getStreamStats=function(a,b){if(!d.socket)return"Error getting stats - no socket";if(!a)return"Error getting stats - no stream";G("getStreamStats",a.getID(),function(a){a&&b(a)})};d.getStreamsByAttribute=function(a,b){var c=[],e;for(e in d.remoteStreams)if(d.remoteStreams.hasOwnProperty(e)){var f=d.remoteStreams[e];void 0!==f.getAttributes()&&void 0!==
f.getAttributes()[a]&&f.getAttributes()[a]===b&&c.push(f)}return c};d.deleteStream=function(a){void 0!==a.stream&&(a.hide(),a.pc&&a.pc.removeStream(a.stream),a.local&&a.stream.stop(),delete a.stream)};d.addStream=function(a){a||L.Logger.warning("[tk-sdk]not stream to addStream");a.pc.addStream(a)};d.seekPlayback=function(a){if(D)try{a=Number(a),d.socket.emit("seekPlayback",a)}catch(O){L.Logger.error("[tk-sdk]The seek posttion must be a number, in milliseconds !")}else L.Logger.warning("[tk-sdk]No playback environment!")};
d.pausePlayback=function(){D?d.socket.emit("pausePlayback"):L.Logger.warning("[tk-sdk]No playback environment!")};d.playPlayback=function(){D?d.socket.emit("Playback"):L.Logger.warning("[tk-sdk]No playback environment!")};d.playbackClearAll=function(){D?(void 0!=B&&(Y(C),Z(B)),null!=p&&(p.publishstate=TK.PUBLISH_STATE_NONE)):L.Logger.error("[tk-sdk]No playback environment, no execution playbackClearAll!")};var K=function(a){L.Logger.info("[tk-sdk]setStatus to: "+a);y!=a&&(y=a,6==y?(C[p.role]||(C[p.role]=
{}),C[p.role][p.id]=p,B[p.id]=p,p.publishstate>TK.PUBLISH_STATE_NONE&&(b(p.publishstate),d.publish(v))):8==y?f():0==y&&f())},Z=function(a){for(var b in a){if(D&&b===p.id)break;delete a[b]}},Y=function(a){for(var b in a){if(D&&b===p.id)break;delete a[b]}},V=function(a,b,c,d,e,f){x=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");x.open(a,b,c);x.setRequestHeader("Content-Type",f?f:"application/x-www-form-urlencoded;charset\x3dutf-8");x.send(d);x.onreadystatechange=e;return x},
da=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}();d.initPlaybackInfo=function(a,b,c,e){if(c){if("string"===typeof c)try{c=JSON.parse(c)}catch(la){L.Logger.error("[tk-sdk]params type must is json! ");return}void 0===c.roomtype||void 0===c.serial||void 0===c.recordfilepath?L.Logger.error("[tk-sdk]The params must be included [roomtype , serial , recordfilepath] ! "):(K(1),l=a,n=
b,a={roomtype:c.roomtype,maxvideo:c.maxvideo||0==c.roomtype?2:1E4,roomrole:-1,serial:c.serial,roomname:c.roomname||"Play Back",recordfilepath:c.recordfilepath,domain:c.domain,host:c.host,companyid:c.companyid||-1},b=da()+":playback",c={},a.roomtype=Number(a.roomtype),a.maxvideo=parseInt(a.maxvideo),a.roomrole=Number(a.roomrole),t=a,h=a.serial,r=a.roomname,q=a.roomtype,F=a.maxvideo,S=a.recordfilepath,c.properties={},c.properties.role=-1,c.properties.nickname="playback",c.id=b,p=TK.RoomUser(c),P=TK.AVMgr,
D=!0,d.setIsGetFileList(!1),N=!1,e&&"function"===typeof e&&e(c,t))}else L.Logger.error("[tk-sdk]params is required ,params type is json !")};d.checkroom=function(a,b,c,d,e){K(1);l=a;n=b;a="https://"+a+":"+b+"/ClientAPI/checkroom?ts\x3d"+(new Date).getTime();b=!0;var f="";if("string"===typeof c)f=c;else for(var g in c)b?b=!1:f+="\x26",f=f+g+"\x3d"+c[g];L.Logger.info("[tk-sdk]Going to checkroom",f);V("POST",a,!0,f,function(){L.Logger.debug("[tk-sdk]Http status ",x.readyState);if(4==x.readyState)if(200==
x.status){var a=JSON.parse(x.responseText);L.Logger.info("[tk-sdk]checkroom resp \x3d ",a);var b={},c=a.result;if(0==c){var f=a.room;var g=a.pullinfo;if(void 0===f.serial)c=-1;else{f.roomtype=Number(f.roomtype);f.maxvideo=parseInt(f.maxvideo);f.roomrole=Number(f.roomrole);var n={},k={};if(g&&g.data&&g.data.pullConfigureList){var m=g.data.pullConfigureList,l;for(l in m){var M=m[l];n[M.pullProtocol]=M.pullUrlList}}if(g&&g.data&&g.data.pushConfigureInfo)for(l in g=g.data.pushConfigureInfo,g)m=g[l],k[m.pushProtocol]=
m.pushUrl;f.pullConfigure=n;f.pushConfigure=k;t=f;h=f.serial;r=f.roomname;q=f.roomtype;F=f.maxvideo;b.properties={};b.properties.role=a.roomrole;b.properties.nickname=a.nickname;a=a.thirdid;b.id=void 0!==a&&"0"!=a&&""!=a?a:e?e:da();p=TK.RoomUser(b);a=q;n=p.role;k=f.videotype;f=f.videoframerate;a=Number(a);n=Number(n);k=Number(k);f=Number(f);0<a&&2<=n&&(k=Math.max(0,Math.min(1,k-1)));w=aa[k][0];I=aa[k][1];u=10>f?10:30<f?30:f;z=176>=w?20>u?128:192:320>=w?20>u?256:384:640>=w?20>u?384:512:1280>=w?15>
u?1024:15<=u&&20>=u?1280:1536:15>u?1280:15<=u&&20>=u?1536:2048;f={room_video_width:w,room_video_height:I,room_video_fps:u};P=TK.AVMgr;P.setAVMgrProperty(f);L.Logger.info("[tk-sdk]video config:"+w+"*"+I+", "+u+", "+z)}}L.Logger.info("[tk-sdk]checkroom success");d(c,b,t)}else L.Logger.error("[tk-sdk]checkroom fail[readyState-status]:",x.readyState,x.status),d(3,x.responseText)})};d.getAVMgr=function(){return P};var ha=function(a,b,c){K(2);void 0==h?c(3,null):(L.Logger.info("[tk-sdk]Going to getConfig"),
b="https://"+a+":"+b+"/ClientAPI/getconfig?ts\x3d"+(new Date).getTime(),V("POST",b,!0,"serial\x3d"+h,function(){if(4==x.readyState)if(200==x.status){var b=JSON.parse(x.responseText);L.Logger.info("[tk-sdk]getConfig resp \x3d ",b);H=b;var d=a,e="8889";if(void 0===E||void 0===A){if(void 0!==b.courseserver){var f=b.courseserver;null!=f&&0<f.length&&(d=f)}void 0!==b.courseserverport&&(e=b.courseserverport)}else d=E,e=A;m="https://"+d+":"+e;ka(d,8080);L.Logger.info("[tk-sdk]_room_uri \x3d "+m);c(null!=
m?0:3,null)}else L.Logger.error("[tk-sdk]getConfig fail[readyState-status]:",x.readyState,x.status),c(3,x.responseText)}))},ia=function(a,b,c){void 0===h?c(3,void 0):X?(L.Logger.info("[tk-sdk]Going to getFileList"),a="https://"+a+":"+b+"/ClientAPI/getroomfile?ts\x3d"+(new Date).getTime(),V("POST",a,!0,"serial\x3d"+h,function(){if(4==x.readyState)if(200==x.status){var a=JSON.parse(x.responseText);L.Logger.info("[tk-sdk]getFileList resp \x3d ",a);var b=a.result;if(0==b&&void 0!==a.roomfile)var d=a.roomfile;
c(b,d)}else L.Logger.error("[tk-sdk]getFileList fail[readyState-status]:",x.readyState,x.status),c(3,void 0)})):c(-1,void 0)},ka=function(a,b){b="https://"+a+":"+b+"/index.html?ts\x3d"+(new Date).getTime();(Q=/(192.168.|127.0.0.1|127.17.|localhost)/g.test(a)?!1:!0)&&$.ajax({url:b,type:"get",async:!1}).done(function(a){L.Logger.info("[tk-sdk]getfalsificationIp resp :",a);a&&"string"===typeof a&&(W=a.toString())}).fail(function(a){L.Logger.error("[tk-sdk]getfalsificationIp fail:",a)})},ja=function(a,
b){L.Logger.info("[tk-sdk]step3Connect");3<=y||(K(3),fa(m,function(a,b){var c=b.roominfo;a=b.msglist;var e=b.userlist,f=0,g=[];var h=c.streams||[];d.p2p=c.p2p;var n=c.id;d.iceServers=c.iceServers;k.defaultVideoBW=z;k.maxVideoBW=z;K(6);for(f in h)if(h.hasOwnProperty(f)){var m=h[f];c=TK.Stream({streamID:m.id,local:!1,audio:m.audio,video:m.video,data:m.data,screen:m.screen,attributes:m.attributes,extensionId:m.extensionId});g.push(c);d.remoteStreams[m.id]=c;d.subscribe(c)}for(f in e)e.hasOwnProperty(f)&&
(h=TK.RoomUser(e[f]),void 0!==h&&(C[h.role]||(C[h.role]={}),C[h.role][h.id]=h,B[h.id]=h));e=[];a&&"string"==typeof a&&(a=JSON.parse(a));for(f in a)a.hasOwnProperty(f)&&e.push(a[f]);e.sort(function(a,b){return void 0!==a&&a.hasOwnProperty("seq")&&void 0!==b&&b.hasOwnProperty("seq")?a.seq-b.seq:0});d.roomID=n;L.Logger.info("[tk-sdk]Connected to room "+d.roomID);L.Logger.info("[tk-sdk]connected response:",b);b=TK.RoomEvent({type:"room-connected",streams:g,message:e});d.dispatchEvent(b);N&&(d.stopIntervalRtcStatsrObserver(),
d.startIntervalRtcStatsrObserver())},function(a){L.Logger.error("[tk-sdk]Not Connected! Error: "+a);a=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.ROOMCONNECTERROR,error:a}});d.dispatchEvent(a)}))},ea=function(a,b){if(!(5<=y))if(void 0==p.id||void 0==h)L.Logger.error("[tk-sdk]Invalid status",p,h);else{K(5);var c={},d;for(d in p)"id"!=d&&"watchStatus"!=d&&(c[d]=p[d]);c={userId:p.id,roomId:D?h+"_"+p.id:h,maxVideo:F,videofps:u,videowidth:w,videoheight:I,properties:c};if(D){if(!S){L.Logger.error("[tk-sdk]The playback file address does not exist!");
return}c.recordfilepath=S}G("joinRoom",c,a,b)}};d.controlMedia=function(a,b){d.socket.emit("controlmedia",a,b)};d.changeLocalDeviceToLocalstream=function(b,c,e){d.getAVMgr().changeLocalDeviceToLocalstream(function(b){if(v.stream){for(var c=v.stream.getTracks(),e=0;e<c.length;e++){var f=c[e];v.stream.removeTrack(f)}b=b.getTracks();for(e=0;e<b.length;e++)f=b[e],v.stream.addTrack(f)}else v.stream=b;v.player&&v.player.changeMediaStreamUrl(v.stream);p.publishstate>TK.PUBLISH_STATE_NONE&&d.unpublish(v,
function(b,c){a(p.publishstate===TK.PUBLISH_STATE_AUDIOONLY||p.publishstate===TK.PUBLISH_STATE_BOTH);g(p.publishstate===TK.PUBLISH_STATE_VIDEOONLY||p.publishstate===TK.PUBLISH_STATE_BOTH);void 0!=b&&d.publish(v)})},b,c,e)};d.getUploadFileParams=function(a,b){return{serial:t.serial,userid:p.id,sender:p.nickname,conversion:1,isconversiondone:0,writedb:1,fileoldname:a,fieltype:b,alluser:1}};d.uploadFile=function(a,b,c){var d="https://"+l+":"+n+"/ClientAPI/uploaddocument?ts\x3d"+(new Date).getTime();
if(a)return $.ajax({url:d,dataType:"json",type:"POST",data:a,async:!0,processData:!1,contentType:!1,xhr:function(){var a=$.ajaxSettings.xhr();if(a.upload)return L.Utils.addEvent(a.upload,"progress",function(a){var b=Math.floor(100*a.loaded/a.total);c&&"function"===typeof c&&c(a,b)},!1),a}}).done(function(a){L.Logger.info("[tk-sdk]uploadFile resp \x3d ",a);b&&"function"===typeof b&&b(a.result,a)}).fail(function(a,c,d){L.Logger.error("[tk-sdk]uploadFile fail[ jqXHR , textStatus , errorThrown ]:",a,
c,d);b(3,void 0)});L.Logger.error("[tk-sdk]uploadFile formData is required!")};d.deleteFile=function(a,b){var c="https://"+l+":"+n+"/ClientAPI/delroomfile?ts\x3d"+(new Date).getTime();void 0===a||null===a?L.Logger.error("[tk-sdk]deleteFile fileid is required!"):$.ajax({url:c,dataType:"json",type:"POST",anync:!1,data:{serial:t.serial,fileid:a}}).done(function(a){L.Logger.info("[tk-sdk]deleteFile resp \x3d ",a);b&&"function"===typeof b&&b(a.result,a)}).fail(function(a,c,d){L.Logger.error("[tk-sdk]deleteFile fail[ jqXHR , textStatus , errorThrown ]:",
a,c,d);b(3,void 0)})};d.setIsGetRtcStatsrObserver=function(a){N=a};d.setRtcStatsrObserverTimer=function(a){T=a};d.stopIntervalRtcStatsrObserver=function(){clearInterval(d._rtcStatsrObserverTimer);d._rtcStatsrObserverTimer=null};d.startIntervalRtcStatsrObserver=function(){clearInterval(d._rtcStatsrObserverTimer);d._rtcStatsrObserverTimer=setInterval(function(){for(var a in d.remoteStreams){var b=d.remoteStreams[a];b&&b.pc&&d.rtcStatsrObserver(b)}},T)};d.stopIntervalRtcStatsrObserverByStream=function(a){a?
(clearInterval(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=null):L.Logger.error("[tk-sdk]stream is not exist!")};d.startIntervalRtcStatsrObserverByStream=function(a,b){b=b||T;a?(clearInterval(a.rtcStatsrObserverTimer),a.rtcStatsrObserverTimer=setInterval(function(){a&&a.pc&&d.rtcStatsrObserver(a)},b)):L.Logger.error("[tk-sdk]stream is not exist!")};d.rtcStatsrObserver=function(a){if(a)if(a.extensionId===p.id&&d.localStreams[a.getID()]&&(a=v),!a.pc)L.Logger.error("[tk-sdk]stream.pc is not exist , stream id and extensionId:"+
a.getID()+","+a.extensionId+"!");else{if(a&&a.pc)if(a.pc.getStats)a.pc.getStats(null).then(function(b){(b=e(a,b))?(a.networkStatus=b,b=TK.StreamEvent({type:"stream-rtcStats",stream:a,message:{networkStatus:b}}),d.dispatchEvent(b)):d.rtcStatsrObserver(a)});else{L.Logger.error("[tk-sdk]pc.getStats is not exist!");clearTimeout(d._rtcStatsrObserverTimer);clearTimeout(a.rtcStatsrObserverTimer);var b=TK.StreamEvent({type:"stream-rtcStats-failed",stream:a,message:{error:"pc.getStats is not exist!"}});d.dispatchEvent(b)}}else L.Logger.error("[tk-sdk]stream is not exist!")};
d.initBroadcast=function(a,b,c,d,e){tknative.postMessage({command:"setBroadcast",isNeed:!0,url:a,bitrate:Number(b),key_sec:Number(c),sampleRates:Number(d),speakers:Number(e)})};d.startBroadcast=function(){tknative.postMessage({command:"startBroadcast"})};d.stopBroadcast=function(){tknative.postMessage({command:"stopBroadcast"})};return d};TK=TK||{};TK.PUBLISH_STATE_NONE=0;TK.PUBLISH_STATE_AUDIOONLY=1;TK.PUBLISH_STATE_VIDEOONLY=2;TK.PUBLISH_STATE_BOTH=3;TK.PUBLISH_STATE_MUTEALL=4;TK.RoomUser=function(b){if(void 0==b||void 0===b.properties)L.Logger.warning("[tk-sdk]Invalidate user info",a,g);else{var a=b.id,g=b.properties;L.Logger.debug("[tk-sdk]RoomUser",a,g);b={};b.id=a;b.watchStatus=0;for(var f in g)"id"!=f&&"watchStatus"!=f&&(b[f]=g[f]);b.publishstate=b.publishstate||TK.PUBLISH_STATE_NONE;return b}};var L=L||{};TK=TK||{};
L.Logger=function(b){var a="",g=!1;var f=function(a,e){try{switch(e){case b.Logger.DEBUG:g?console.warn.apply(console,a):console.debug.apply(console,a);break;case b.Logger.TRACE:console.trace.apply(console,a);break;case b.Logger.INFO:g?console.warn.apply(console,a):console.info.apply(console,a);break;case b.Logger.WARNING:console.warn.apply(console,a);break;case b.Logger.ERROR:console.error.apply(console,a);break;case b.Logger.NONE:console.warn("log level is none!");break;default:g?console.warn.apply(console,
a):console.log.apply(console,a)}}catch(k){console.log.apply(console,a)}};return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogDevelopment:function(a){g=a},enableLogPanel:function(){b.Logger.panel=document.createElement("textarea");b.Logger.panel.setAttribute("id","licode-logs");b.Logger.panel.setAttribute("style","width: 100%; height: 100%; display: none");b.Logger.panel.setAttribute("rows",20);b.Logger.panel.setAttribute("cols",20);b.Logger.panel.setAttribute("readOnly",!0);document.body.appendChild(b.Logger.panel)},
setLogLevel:function(a){a>b.Logger.NONE?a=b.Logger.NONE:a<b.Logger.DEBUG&&(a=b.Logger.DEBUG);b.Logger.logLevel=a},setOutputFunction:function(a){f=a},setLogPrefix:function(b){a=b},print:function(c){var e=a;if(!(c<b.Logger.logLevel)){c===b.Logger.DEBUG?e=e+"DEBUG("+(new Date).toLocaleString()+")":c===b.Logger.TRACE?e=e+"TRACE("+(new Date).toLocaleString()+")":c===b.Logger.INFO?e=e+"INFO("+(new Date).toLocaleString()+")":c===b.Logger.WARNING?e=e+"WARNING("+(new Date).toLocaleString()+")":c===b.Logger.ERROR&&
(e=e+"ERROR("+(new Date).toLocaleString()+")");e+=":";for(var g=[],d=0;d<arguments.length;d++)g[d]=arguments[d];g=g.slice(1);g=[e].concat(g);if(void 0!==b.Logger.panel){e="";for(d=0;d<g.length;d++)e+=g[d];b.Logger.panel.value=b.Logger.panel.value+"\n"+e}else f.apply(b.Logger,[g,c])}},debug:function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];b.Logger.print.apply(b.Logger,[b.Logger.DEBUG].concat(a))},trace:function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];b.Logger.print.apply(b.Logger,
[b.Logger.TRACE].concat(a))},info:function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];b.Logger.print.apply(b.Logger,[b.Logger.INFO].concat(a))},warning:function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];b.Logger.print.apply(b.Logger,[b.Logger.WARNING].concat(a))},error:function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];b.Logger.print.apply(b.Logger,[b.Logger.ERROR].concat(a))}}}(L);
TK.tkLogPrintConfig=function(b,a,g){a=a||{};b=b||{};g=g||{};var f=void 0!=a.logLevel?a.logLevel:0;b=void 0!=b.debug?b.debug:!0;g=void 0!=g.webrtcLogDebug?g.webrtcLogDebug:!0;L.Logger.setLogDevelopment(void 0!=a.development?a.development:!0);L.Logger.setLogLevel(f);window.localStorage&&window.localStorage.setItem("debug",b?"*":"none");window.webrtcLogDebug=g};L=L||{};
L.Base64=function(){var b,a,g;var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");var c=[];for(g=0;g<f.length;g+=1)c[f[g]]=g;var e=function(c){b=c;a=0};var k=function(){if(!b||a>=b.length)return-1;var c=b.charCodeAt(a)&255;a+=1;return c};var d=function(){if(!b)return-1;for(;;){if(a>=b.length)return-1;var d=b.charAt(a);a+=1;if(c[d])return c[d];if("A"===d)return 0}};var l=function(a){a=a.toString(16);1===a.length&&(a="0"+a);return unescape("%"+a)};return{encodeBase64:function(a){var b;e(a);
a="";var c=Array(3);var d=0;for(b=!1;!b&&-1!==(c[0]=k());)c[1]=k(),c[2]=k(),a+=f[c[0]>>2],-1!==c[1]?(a+=f[c[0]<<4&48|c[1]>>4],-1!==c[2]?(a+=f[c[1]<<2&60|c[2]>>6],a+=f[c[2]&63]):(a+=f[c[1]<<2&60],a+="\x3d",b=!0)):(a+=f[c[0]<<4&48],a+="\x3d",a+="\x3d",b=!0),d+=4,76<=d&&(a+="\n",d=0);return a},decodeBase64:function(a){var b;e(a);a="";var c=Array(4);for(b=!1;!b&&-1!==(c[0]=d())&&-1!==(c[1]=d());)c[2]=d(),c[3]=d(),a+=l(c[0]<<2&255|c[1]>>4),-1!==c[2]?(a+=l(c[1]<<4&255|c[2]>>2),-1!==c[3]?a+=l(c[2]<<6&255|
c[3]):b=!0):b=!0;return a}}}(L);/*
 https://github.com/Mr0grog/element-query/blob/master/LICENSE

 @param element
 @param value
 @param units
 @returns {*}
*/
(function(){function b(){(new g.ElementQueries).init()}function a(a,b){var c=Object.prototype.toString.call(a),d=0,e=a.length;if("[object Array]"===c||"[object NodeList]"===c||"[object HTMLCollection]"===c||"undefined"!==typeof jQuery&&a instanceof jQuery||"undefined"!==typeof Elements&&a instanceof Elements)for(;d<e;d++)b(a[d]);else b(a)}var g=this.L=this.L||{};g.ElementQueries=function(){function a(a){a||(a=document.documentElement);a=getComputedStyle(a,"fontSize");return parseFloat(a)||16}function b(b,
c){var d=c.replace(/[0-9]*/,"");c=parseFloat(c);switch(d){case "px":return c;case "em":return c*a(b);case "rem":return c*a();case "vw":return c*document.documentElement.clientWidth/100;case "vh":return c*document.documentElement.clientHeight/100;case "vmin":case "vmax":return c*(0,Math["vmin"===d?"min":"max"])(document.documentElement.clientWidth/100,document.documentElement.clientHeight/100);default:return c}}function f(a){this.element=a;this.options=[];var c,d,e,f=0,g=0,h,n,k,m,l;this.addOption=
function(a){this.options.push(a)};var A=["min-width","min-height","max-width","max-height"];this.call=function(){f=this.element.offsetWidth;g=this.element.offsetHeight;k={};c=0;for(d=this.options.length;c<d;c++)e=this.options[c],h=b(this.element,e.value),n="width"===e.property?f:g,l=e.mode+"-"+e.property,m="","min"===e.mode&&n>=h&&(m+=e.value),"max"===e.mode&&n<=h&&(m+=e.value),k[l]||(k[l]=""),m&&-1===(" "+k[l]+" ").indexOf(" "+m+" ")&&(k[l]+=" "+m);for(var a in A)k[A[a]]?this.element.setAttribute(A[a],
k[A[a]].substr(1)):this.element.removeAttribute(A[a])}}function d(a,b){a.elementQueriesSetupInformation?a.elementQueriesSetupInformation.addOption(b):(a.elementQueriesSetupInformation=new f(a),a.elementQueriesSetupInformation.addOption(b),new g.ResizeSensor(a,function(){a.elementQueriesSetupInformation.call()}));a.elementQueriesSetupInformation.call()}function l(a){var b;for(a=a.replace(/'/g,'"');null!==(b=m.exec(a));)if(5<b.length){var c=void 0,e=b[1]||b[5],f=b[2],g=b[3];b=b[4];document.querySelectorAll&&
(c=document.querySelectorAll.bind(document));c||"undefined"===typeof $$||(c=$$);c||"undefined"===typeof jQuery||(c=jQuery);if(!c)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";c=c(e);e=0;for(var h=c.length;e<h;e++)d(c[e],{mode:f,property:g,value:b})}}function n(a){if(a)if("string"===typeof a)a=a.toLowerCase(),-1===a.indexOf("min-width")&&-1===a.indexOf("max-width")||l(a);else for(var b=0,c=a.length;b<c;b++)if(1===a[b].type){var d=a[b].selectorText||a[b].cssText;-1!==d.indexOf("min-height")||
-1!==d.indexOf("max-height")?l(d):(-1!==d.indexOf("min-width")||-1!==d.indexOf("max-width"))&&l(d)}else 4===a[b].type&&n(a[b].cssRules||a[b].rules)}var m=/,?([^,\n]*)\[[\s\t]*(min|max)-(width|height)[\s\t]*[~$\^]?=[\s\t]*"([^"]*)"[\s\t]*]([^\n\s\{]*)/mgi;this.init=function(){for(var a=0,b=document.styleSheets.length;a<b;a++)n(document.styleSheets[a].cssText||document.styleSheets[a].cssRules||document.styleSheets[a].rules)}};window.addEventListener?window.addEventListener("load",b,!1):window.attachEvent("onload",
b);var f=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return window.setTimeout(a,20)};g.ResizeSensor=function(b,e){function c(){var a=[];this.add=function(b){a.push(b)};var b,c;this.call=function(){b=0;for(c=a.length;b<c;b++)a[b].call()};this.remove=function(d){var e=[];b=0;for(c=a.length;b<c;b++)a[b]!==d&&e.push(a[b]);a=e};this.length=function(){return a.length}}function d(a,b){return a.currentStyle?a.currentStyle[b]:window.getComputedStyle?
window.getComputedStyle(a,null).getPropertyValue(b):a.style[b]}function l(a,b){if(!a.resizedAttached)a.resizedAttached=new c,a.resizedAttached.add(b);else if(a.resizedAttached){a.resizedAttached.add(b);return}a.resizeSensor=document.createElement("div");a.resizeSensor.className="resize-sensor";a.resizeSensor.style.cssText="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;";a.resizeSensor.innerHTML='\x3cdiv class\x3d"resize-sensor-expand" style\x3d"position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"\x3e\x3cdiv style\x3d"position: absolute; left: 0; top: 0; transition: 0s;"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"resize-sensor-shrink" style\x3d"position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"\x3e\x3cdiv style\x3d"position: absolute; left: 0; top: 0; transition: 0s; width: 200%; height: 200%"\x3e\x3c/div\x3e\x3c/div\x3e';
a.appendChild(a.resizeSensor);"static"===d(a,"position")&&(a.style.position="relative");var e=a.resizeSensor.childNodes[0],g=e.childNodes[0],k=a.resizeSensor.childNodes[1],l=function(){g.style.width="100000px";g.style.height="100000px";e.scrollLeft=1E5;e.scrollTop=1E5;k.scrollLeft=1E5;k.scrollTop=1E5};l();var m=!1,n=function(){a.resizedAttached&&(m&&(a.resizedAttached.call(),m=!1),f(n))};f(n);var u,z,F,H;b=function(){if((F=a.offsetWidth)!==u||(H=a.offsetHeight)!==z)m=!0,u=F,z=H;l()};var E=function(a,
b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c)};E(e,"scroll",b);E(k,"scroll",b)}a(b,function(a){l(a,e)});this.detach=function(a){g.ResizeSensor.detach(b,a)}};g.ResizeSensor.detach=function(b,e){a(b,function(a){if(a.resizedAttached&&"function"===typeof e&&(a.resizedAttached.remove(e),a.resizedAttached.length()))return;a.resizeSensor&&(a.contains(a.resizeSensor)&&a.removeChild(a.resizeSensor),delete a.resizeSensor,delete a.resizedAttached)})}})();TK=TK||{};TK.View=function(){var b=TK.EventDispatcher({});b.url="";return b};TK=TK||{};
TK.VideoPlayer=function(b){b.options.bar=void 0!=b.options.bar?b.options.bar:!1;b.stream.stream||L.Logger.warning("[tk-sdk]VideoPlayer: media stream  is not exist!");var a=TK.View({});a.id=b.id;a.stream=b.stream.stream;a.elementID=b.elementID;var g=function(){a.bar.display()};var f=function(){a.bar.hide()};a.destroy=function(){a.video.pause();delete a.resizer;a.parentNode.removeChild(a.div)};a.resize=function(){var c=a.container.offsetWidth,e=a.container.offsetHeight;if(b.stream.screen||!1===b.options.crop)9/
16*c<e?(a.video.style.width=c+"px",a.video.style.height=9/16*c+"px",a.video.style.top=-(9/16*c/2-e/2)+"px",a.video.style.left="0px"):(a.video.style.height=e+"px",a.video.style.width=16/9*e+"px",a.video.style.left=-(16/9*e/2-c/2)+"px",a.video.style.top="0px");else if(c!==a.containerWidth||e!==a.containerHeight)3/4*c>e?(a.video.style.width=c+"px",a.video.style.height=3/4*c+"px",a.video.style.top=-(3/4*c/2-e/2)+"px",a.video.style.left="0px"):(a.video.style.height=e+"px",a.video.style.width=4/3*e+"px",
a.video.style.left=-(4/3*e/2-c/2)+"px",a.video.style.top="0px");a.containerWidth=c;a.containerHeight=e};a.stream&&"object"===typeof a.stream&&a.stream.playbackquUrl?(L.Logger.debug("[tk-sdk]Creating palyback URL from stream "+a.stream),a.streamUrl=a.stream.playbackquUrl):a.stream&&(L.Logger.debug("[tk-sdk]Creating URL from stream "+a.stream),a.streamUrl=(window.URL||webkitURL).createObjectURL(a.stream));a.div=document.createElement("div");a.div.setAttribute("id","player_"+a.id);a.div.setAttribute("class",
"Talk_player");a.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;");!1!==b.options.loader&&(a.loader=document.createElement("div"),a.loader.setAttribute("id","back_"+a.id),a.loader.setAttribute("class","Talk_loader"));a.video=document.createElement("video");a.video.setAttribute("id","stream"+a.id);a.video.setAttribute("class","Talk_stream");a.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000;");
a.video.setAttribute("autoplay","autoplay");a.showVideo=function(){a.video&&(a.video.style.display="block")};a.hideVideo=function(){a.video&&(a.video.style.display="none")};b.stream.local&&(a.video.volume=0);a.container=void 0!==a.elementID?"object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID):document.body;a.container.appendChild(a.div);a.parentNode=a.div.parentNode;a.loader&&a.div.appendChild(a.loader);a.div.appendChild(a.video);
a.containerWidth=0;a.containerHeight=0;!1!==b.options.bar?(a.bar=new TK.Bar({elementID:"player_"+a.id,id:a.id,stream:b.stream,media:a.video,options:b.options}),a.div.onmouseover=g,a.div.onmouseout=f):a.media=a.video;a.streamUrl&&(a.video.src=a.streamUrl);a.video.onloadedmetadata=function(b){a.loader.style.display="none";a.div.style.backgroundColor="transparent"};a.changeMediaStreamUrl=function(b){a.video&&b&&(a.stream=b,a.stream&&"object"===typeof a.stream&&a.stream.playbackquUrl?(L.Logger.debug("[tk-sdk]Creating palyback URL from stream "+
a.stream),a.streamUrl=a.stream.playbackquUrl):a.stream&&(L.Logger.debug("[tk-sdk]Creating URL from stream "+a.stream),a.streamUrl=(window.URL||webkitURL).createObjectURL(a.stream)),a.streamUrl&&(a.video.src=a.streamUrl))};return a};TK=TK||{};
TK.NativeVideoPlayer=function(b){b.options.bar=void 0!=b.options.bar?b.options.bar:!1;b.stream.stream||L.Logger.warning("VideoPlayer: media stream  is not exist!");var a=TK.View({});a.id=b.id;a.stream=b.stream.stream;a.elementID=b.elementID;var g=function(){a.bar.display()};var f=function(){a.bar.hide()};a.destroy=function(){a.parentNode.removeChild(a.div)};a.resize=function(){var c=a.container.offsetWidth,e=a.container.offsetHeight;if(b.stream.screen||!1===b.options.crop)9/16*c<e?(a.video.style.width=c+
"px",a.video.style.height=9/16*c+"px",a.video.style.top=-(9/16*c/2-e/2)+"px",a.video.style.left="0px"):(a.video.style.height=e+"px",a.video.style.width=16/9*e+"px",a.video.style.left=-(16/9*e/2-c/2)+"px",a.video.style.top="0px");else if(console.error(a.container.offsetWidth,a.container.offsetHeight,b.stream.screen,b.options.crop,a.containerWidth,a.containerHeight),c!==a.containerWidth||e!==a.containerHeight)3/4*c>e?(a.video.style.width=c+"px",a.video.style.height=3/4*c+"px",a.video.style.top=-(3/
4*c/2-e/2)+"px",a.video.style.left="0px"):(a.video.style.height=e+"px",a.video.style.width=4/3*e+"px",a.video.style.left=-(4/3*e/2-c/2)+"px",a.video.style.top="0px");a.containerWidth=c;a.containerHeight=e};a.div=document.createElement("div");a.div.setAttribute("id","player_"+a.id);a.div.setAttribute("class","Talk_player");a.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;");!1!==b.options.loader&&(a.loader=document.createElement("div"),
a.loader.setAttribute("id","back_"+a.id),a.loader.setAttribute("class","Talk_loader"));a.video=document.createElement("embed");a.video.setAttribute("id",a.id);a.video.setAttribute("class","Talk_stream");a.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000;");a.video.setAttribute("type","application/x-ppapi-proxy");a.showVideo=function(){};a.hideVideo=function(){};a.container=void 0!==a.elementID?"object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?
a.elementID:document.getElementById(a.elementID):document.body;a.container.appendChild(a.div);a.parentNode=a.div.parentNode;a.loader&&a.div.appendChild(a.loader);a.div.appendChild(a.video);a.containerWidth=0;a.containerHeight=0;!1!==b.options.bar?(a.bar=new TK.Bar({elementID:"player_"+a.id,id:a.id,stream:b.stream,media:a.video,options:b.options}),a.div.onmouseover=g,a.div.onmouseout=f):a.media=a.video;a.video.onloadedmetadata=function(b){a.loader.style.display="none";a.div.style.backgroundColor="transparent"};
a.changeMediaStreamUrl=function(a){};return a};TK=TK||{};TK.ChromeStableStack=10;
TK.AudioPlayer=function(b){var a=TK.View({});a.id=b.id;a.stream=b.stream.stream;a.elementID=b.elementID;L.Logger.debug("[tk-sdk]Creating URL from stream "+a.stream);a.streamUrl=(window.URL||webkitURL).createObjectURL(a.stream);a.audio=document.createElement("audio");a.audio.setAttribute("id","stream"+a.id);a.audio.setAttribute("class","Talk_stream");a.audio.setAttribute("style","width: 100%; height: 100%; position: absolute");a.audio.setAttribute("autoplay","autoplay");b.stream.local&&(a.audio.volume=
0);b.stream.local&&(a.audio.volume=0);if(void 0!==a.elementID){a.destroy=function(){a.audio.pause();a.parentNode.removeChild(a.div)};var g=function(){a.bar.display()};var f=function(){a.bar.hide()};a.div=document.createElement("div");a.div.setAttribute("id","player_"+a.id);a.div.setAttribute("class","Talk_player");a.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;");a.container="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:
document.getElementById(a.elementID);a.container.appendChild(a.div);a.parentNode=a.div.parentNode;a.div.appendChild(a.audio);!1!==b.options.bar?(a.bar=new TK.Bar({elementID:"player_"+a.id,id:a.id,stream:b.stream,media:a.audio,options:b.options}),a.div.onmouseover=g,a.div.onmouseout=f):a.media=a.audio}else a.destroy=function(){a.audio.pause();a.parentNode.removeChild(a.audio)},document.body.appendChild(a.audio),a.parentNode=document.body;a.audio.src=a.streamUrl;return a};TK=TK||{};
TK.Bar=function(b){var a=TK.View({}),g;a.elementID=b.elementID;a.id=b.id;a.div=document.createElement("div");a.div.setAttribute("id","bar_"+a.id);a.div.setAttribute("class","Talk_bar");a.bar=document.createElement("div");a.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)");a.bar.setAttribute("id","subbar_"+a.id);a.bar.setAttribute("class","Talk_subbar");a.link=document.createElement("a");a.link.setAttribute("href",
b&&b.options&&b.options.link?b.options.link:"http://www.talk-cloud.com/");a.link.setAttribute("class","Talk_link");a.link.setAttribute("target","_blank");a.logo=document.createElement("div");a.logo.setAttribute("style","width: 100%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;");a.logo.setAttribute("class","Talk_logo");a.logo.setAttribute("alt","Lynckia");var f=function(b){"block"!==b?b="none":clearTimeout(g);a.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+
b)};a.display=function(){f("block")};a.hide=function(){g=setTimeout(f,1E3)};document.getElementById(a.elementID).appendChild(a.div);a.div.appendChild(a.bar);a.bar.appendChild(a.link);a.link.appendChild(a.logo);b.stream.screen||void 0!==b.options&&void 0!==b.options.speaker&&!0!==b.options.speaker||(a.speaker=new TK.Speaker({elementID:"subbar_"+a.id,id:a.id,stream:b.stream,media:b.media}));a.display();a.hide();return a};TK=TK||{};
TK.Speaker=function(b){function a(a,b){if(f(a,b)){for(var c=" "+a.className.replace(/[\t\r\n]/g,"")+" ";0<=c.indexOf(" "+b+" ");)c=c.replace(" "+b+" "," ");a.className=c.replace(/^\s+|\s+$/g,"")}}function g(a,b){f(a,b)||(a.className+=" "+b)}function f(a,b){b=b||"";return 0==b.replace(/\s/g,"").length?!1:(new RegExp(" "+b+" ")).test(" "+a.className+" ")}var c=TK.View({}),e=50;c.elementID=b.elementID;c.media=b.media;c.id=b.id;c.stream=b.stream;c.div=document.createElement("div");c.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;");
c.icon=document.createElement("div");c.icon.setAttribute("id","volume_"+c.id);c.icon.setAttribute("class","Talk_Volume_icon");c.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;");c.div.appendChild(c.icon);if(c.stream.local){var k=function(){c.media.muted=!0;a(c.icon,"sound");g(c.icon,"mute");c.stream.stream.getAudioTracks()[0].enabled=!1};var d=function(){c.media.muted=!1;a(c.icon,"mute");g(c.icon,"sound");c.stream.stream.getAudioTracks()[0].enabled=!0};c.icon.onclick=function(){c.media.muted?
d():k()}}else{c.picker=document.createElement("input");c.picker.setAttribute("id","picker_"+c.id);c.picker.type="range";c.picker.min=0;c.picker.max=100;c.picker.step=10;c.picker.value=e;c.picker.setAttribute("orient","vertical");c.div.appendChild(c.picker);c.media.volume=c.picker.value/100;c.media.muted=!1;c.picker.oninput=function(){c.media.muted=0<c.picker.value?!1:!0;a(c.icon,"sound");g(c.icon,"mute");c.media.volume=c.picker.value/100};var l=function(a){c.picker.setAttribute("style","background: transparent; width: 32px; height: 100px; position: absolute; bottom: 90%; z-index: 1;"+
c.div.offsetHeight+"px; right: 0px; -webkit-appearance: slider-vertical; display: "+a)};k=function(){a(c.icon,"sound");g(c.icon,"mute");e=c.picker.value;c.picker.value=0;c.media.volume=0;c.media.muted=!0};d=function(){a(c.icon,"mute");g(c.icon,"sound");c.picker.value=e;c.media.volume=c.picker.value/100;c.media.muted=!1};c.icon.onclick=function(){c.media.muted?d():k()};c.div.onmouseover=function(){l("block")};c.div.onmouseout=function(){l("none")};l("none")}document.getElementById(c.elementID).appendChild(c.div);
return c};L=L||{};L.Constant=function(){return{roomError:{ROOMCONNECTERROR:0,GETCONFIGERROR:1,GETFILELISTERROR:2},deviceStorage:{audioinput:"audioinputDeviceId",audiooutput:"audiooutputDeviceId",videoinput:"videoinputDeviceId"}}}(L);L=L||{};L.Utils=function(){return{addEvent:function(b,a,g,f){b.addEventListener?b.addEventListener(a,g,void 0!=f&&null!=f?f:!1):b.attachEvent?b.attachEvent("on"+a,g):b["on"+a]=g},removeEvent:function(b,a,g,f){b.addEventListener?b.removeEventListener(a,g,f):b.attachEvent?b.detachEvent("on"+a,g):b["on"+a]=null}}}(L);TK=TK||{};
TK.AVMgr=function(){var b={room_video_width:320,room_video_height:240,room_video_fps:10,setAVMgrProperty:function(a){for(var f in a)b.hasOwnProperty(f)&&(b[f]=a[f])}},a=function(a,f,c,e){var g=function(b){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(b).then(a).catch(f):navigator.getMedia(c,a,f)};navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;c=c||{audio:{},video:{}};f=f||
function(a){L.Logger.error("[tk-sdk]getUserMedia error:",a)};if(c.screen)L.Logger.debug("[tk-sdk]Screen access requested");else{var d={video:{},audio:{},screen:c.screen};"object"===typeof c.audio&&(d.audio=c.audio);e=void 0!=e&&null!=e&&"object"===typeof e?e:{video:{},audio:{},exclude:{}};e.video=e.video||{};e.audio=e.audio||{};var l=c.audio.mandatory||{sourceId:e.audio.sourceId||localStorage.getItem(L.Constant.deviceStorage.audioinput)||""},n=c.video.mandatory||{sourceId:e.video.sourceId||localStorage.getItem(L.Constant.deviceStorage.videoinput)||
"",idealWidth:b.room_video_width||320,maxWidth:b.room_video_width||320,idealHeight:b.room_video_height||240,maxHeight:b.room_video_height||240};d.video.width={ideal:n.idealWidth,max:n.maxWidth};d.video.height={ideal:n.idealHeight,max:n.maxHeight};if(void 0!==c.video.optional)d.video.frameRate=c.video.optional[1].maxFrameRate;else{var m={idealFrameRate:Number(b.room_video_fps||10),maxFrameRate:Number(b.room_video_fps||10)};void 0!=m.idealFrameRate&&void 0!=m.maxFrameRate?d.video.frameRate={ideal:m.idealFrameRate,
max:m.maxFrameRate}:void 0!=m.frameRate&&(d.video.frameRate=m.frameRate)}n.sourceId&&l.sourceId?(l.sourceId?d.audio.deviceId=l.sourceId:d.audio=!1,n.sourceId?d.video.deviceId=n.sourceId:d.video=!1,e.exclude&&e.exclude.video?d.video=!1:e.exclude&&e.exclude.audio&&(d.audio=!1),g(d)):b.enumerateDevices(function(a){var b=a.useDevices;a=a.hasdevice;a.videoinput&&b.videoinput&&!n.sourceId&&(n.sourceId=b.videoinput,localStorage.setItem(L.Constant.deviceStorage.videoinput,n.sourceId));a.audioinput&&b.audioinput&&
!l.sourceId&&(l.sourceId=b.audioinput,localStorage.setItem(L.Constant.deviceStorage.audioinput,l.sourceId));l.sourceId?d.audio.deviceId=l.sourceId:d.audio=!1;n.sourceId?d.video.deviceId=n.sourceId:d.video=!1;e.exclude&&e.exclude.video?d.video=!1:e.exclude&&e.exclude.audio&&(d.audio=!1);g(d)})}};b.getUserMedia=function(b,f,c,e){a(b,f,c,e)};b.enumerateDevices=function(a,b){function c(c){var d=window.localStorage.getItem(L.Constant.deviceStorage.audioinput),e=window.localStorage.getItem(L.Constant.deviceStorage.videoinput),
f=window.localStorage.getItem(L.Constant.deviceStorage.audiooutput);L.Logger.info("enumerate devices:",c);var g={},k={},l={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},useDevices:{}};c.forEach(function(a){null!=a&&"communications"!=a.groupId&&"communications"!=a.deiceId&&"\u901a\u8baf"!=a.label&&("audioinput"===a.kind&&a.deviceId===d&&(l.useDevices[a.kind]=a.deviceId),"videoinput"===a.kind&&a.deviceId===e&&(l.useDevices[a.kind]=a.deviceId),
"audiooutput"===a.kind&&a.deviceId===f&&(l.useDevices[a.kind]=a.deviceId),g[a.kind]=a.deviceId,l.devices[a.kind].push(a),l.hasdevice[a.kind]=!0,"default"===a.deviceId&&(k[a.kind]=a.deviceId))});l.useDevices.audioinput||(l.useDevices.audioinput=k.audioinput||g.audioinput||"");l.useDevices.videoinput||(l.useDevices.videoinput=k.videoinput||g.videoinput||"");l.useDevices.audiooutput||(l.useDevices.audiooutput=k.audiooutput||g.audiooutput||"");window.localStorage?b.isSetlocalStorage&&(window.localStorage.setItem(L.Constant.deviceStorage.audioinput,
l.useDevices.audioinput),window.localStorage.setItem(L.Constant.deviceStorage.videoinput,l.useDevices.videoinput),window.localStorage.setItem(L.Constant.deviceStorage.audiooutput,l.useDevices.audiooutput)):L.Logger.error("[tk-sdk]not support localStorage");a&&"function"===typeof a&&a(l)}b=b||{};b.isSetlocalStorage=void 0!=b.isSetlocalStorage?b.isSetlocalStorage:!1;var e=function(a){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return L.Logger.log("[tk-sdk]enumerateDevices() not supported."),
null;navigator.mediaDevices.enumerateDevices().then(function(b){b.forEach(function(a){L.Logger.info("[tk-sdk]"+a.kind+": "+a.label+" id \x3d "+a.deviceId,a)});a&&"function"===typeof a&&a(b)}).catch(function(a){L.Logger.error("[tk-sdk]"+a.name+": "+a.message);throw a;})},f=function(a){e(function(a){c(a)})},d=function(a){L.Logger.warning("[tk-sdk]getUserMedia error on enumerateDevices:",a);e(function(a){c(a)})};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0,
video:!0}).then(f).catch(d):navigator.getMedia({audio:!0,video:!0},f,d)};b.getsSoundMeterInstance=function(a){return new function(a){var b=this;b.audioContext=a;b.instant=0;b.slow=0;b.clip=0;b.script=b.audioContext.createScriptProcessor(2048,1,1);b.script.onaudioprocess=function(a){a=a.inputBuffer.getChannelData(0);var c,d=0,e=0;for(c=0;c<a.length;++c)d+=a[c]*a[c],.99<Math.abs(a[c])&&(e+=1);b.instant=Math.sqrt(d/a.length);b.slow=.95*b.slow+.05*b.instant;b.clip=e/a.length};b.connectToSource=function(a,
c){L.Logger.info("SoundMeter connecting");try{b.mic=b.audioContext.createMediaStreamSource(a),b.mic.connect(b.script),b.script.connect(b.audioContext.destination),"undefined"!==typeof c&&c(null)}catch(d){L.Logger.error("[tk-sdk]connecToSource error:",d),"undefined"!==typeof c&&c(d)}};b.stop=function(){b.mic.disconnect();b.script.disconnect()};return b}(a)};b.setElementSinkIdToAudioouputDevice=function(a){for(var b=localStorage.getItem(L.Constant.deviceStorage.audiooutput),c=0;c<a.le;c++){var e=a[c];
e&&0<e.length&&(e.setSinkId?e.setSinkId(b).then(function(){L.Logger.info("[tk-sdk]Audio output device set to "+b)}):L.Logger.error("[tk-sdk]The browser does not support the setSinkId method,audiooutputDeviceId:",b))}};b.changeLocalDeviceToLocalstream=function(a,f,c,e){var g={},d;for(d in f)L.Constant.deviceStorage[d]&&f[d]!==localStorage.getItem(L.Constant.deviceStorage[d])&&(localStorage.setItem(L.Constant.deviceStorage[d],f[d]),g[d]=!0);(g.videoinput||g.audioinput)&&b.getUserMedia(function(b){a&&
"function"===typeof a&&a(b);c&&"function"===typeof c&&c(b)});e&&0<e.length&&b.setElementSinkIdToAudioouputDevice(e)};b.addOndevicechange=function(a){navigator.mediaDevices?navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=null,navigator.mediaDevices.ondevicechange=function(b){L.Logger.info("[tk-sdk]AVMgr:ondevicechange event:",b);a&&"function"===typeof a&&a(b)}):L.Logger.error("Browser does not support navigator.mediaDevices!")};b.removeOndevicechange=function(){navigator.mediaDevices?
navigator.mediaDevices.ondevicechange=null:L.Logger.error("Browser does not support navigator.mediaDevices!")};return b}(TK);TK=TK||{};
TK.NativeAVMgr=function(){var b={room_video_width:320,room_video_height:240,room_video_fps:10},a={},g={},f=100;b.setAVMgrProperty=function(a){for(var c in a)b.hasOwnProperty(c)&&(b[c]=a[c])};tknative.addEventListener("message",function(b){if("onEnumerateDevices"===b.data.name){var c=window.localStorage.getItem(L.Constant.deviceStorage.audioinput),d=window.localStorage.getItem(L.Constant.deviceStorage.videoinput),e=window.localStorage.getItem(L.Constant.deviceStorage.audiooutput),f=b.data.audioinput,m=
b.data.videoinput,h=b.data.audiooutput;b=b.data.seq;var q={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},useDevices:{}};q.useDevices.audioinput=void 0!==c&&null!==c&&c<=f.length?c:0<f.length?f[0].deviceId:null;0<f.length&&(q.hasdevice.audioinput=!0);q.devices.audioinput=f;q.useDevices.videoinput=void 0!==d&&null!==d&&d<=m.length?d:0<m.length?m[0].deviceId:null;0<m.length&&(q.hasdevice.videoinput=!0);q.devices.videoinput=m;q.useDevices.audiooutput=
void 0!==e&&null!==e&&e<=h.length?e:0<h.length?h[0].deviceId:null;0<h.length&&(q.hasdevice.audiooutput=!0);q.devices.audiooutput=h;window.localStorage?g[b].isSetlocalStorage&&(window.localStorage.setItem(L.Constant.deviceStorage.audioinput,q.useDevices.audioinput),window.localStorage.setItem(L.Constant.deviceStorage.videoinput,q.useDevices.videoinput),window.localStorage.setItem(L.Constant.deviceStorage.audiooutput,q.useDevices.audiooutput)):console.error("not support localStorage");a[b]&&(a[b](q),
delete a[b]);g[b]&&delete g[b]}},!1);var c=function(a,c,d,f){var e=function(b){tknative.postMessage({command:"setCamera",deviceId:b.video.deviceId,width:Number(b.video.width),height:Number(b.video.height),fps:Number(b.video.frameRate)});tknative.postMessage({command:"setMicrophone",deviceId:b.audio.deviceId});a(null)};d=d||{audio:{},video:{}};if(d.screen)L.Logger.debug("Screen access requested");else{var g={video:{},audio:{},screen:d.screen};"object"===typeof d.audio&&(g.audio=d.audio);f=void 0!=
f&&null!=f&&"object"===typeof f?f:{video:{},audio:{},exclude:{}};f.video=f.video||{};f.audio=f.audio||{};var h=d.audio.mandatory||{sourceId:f.audio.sourceId||localStorage.getItem(L.Constant.deviceStorage.audioinput)||""},k=d.video.mandatory||{sourceId:f.video.sourceId||localStorage.getItem(L.Constant.deviceStorage.videoinput)||"",idealWidth:b.room_video_width||320,maxWidth:b.room_video_width||320,idealHeight:b.room_video_height||240,maxHeight:b.room_video_height||240};g.video.width=k.maxWidth;g.video.height=
k.maxHeight;void 0!==d.video.optional?g.video.frameRate=d.video.optional[1].maxFrameRate:(c={idealFrameRate:Number(b.room_video_fps||10),maxFrameRate:Number(b.room_video_fps||10)},void 0!=c.idealFrameRate&&void 0!=c.maxFrameRate?g.video.frameRate=c.maxFrameRate:void 0!=c.frameRate&&(g.video.frameRate=c.frameRate));k.sourceId&&h.sourceId?(null!==h.sourceId&&void 0!==h.sourceId?g.audio.deviceId=h.sourceId:g.audio=!1,null!==k.sourceId&&void 0!==k.sourceId?g.video.deviceId=k.sourceId:g.video=!1,f.exclude&&
f.exclude.video?g.video=!1:f.exclude&&f.exclude.audio&&(g.audio=!1),e(g)):b.enumerateDevices(function(a){var b=a.useDevices;a=a.hasdevice;null===a.videoinput||void 0===a.videoinput||null===b.videoinput||void 0===b.videoinput||k.sourceId||(k.sourceId=b.videoinput,localStorage.setItem(L.Constant.deviceStorage.videoinput,k.sourceId));null===a.audioinput||void 0===a.audioinput||null===b.audioinput||void 0===b.audioinput||h.sourceId||(h.sourceId=b.audioinput,localStorage.setItem(L.Constant.deviceStorage.audioinput,
h.sourceId));null!==h.sourceId&&void 0!==h.sourceId?g.audio.deviceId=h.sourceId:g.audio=!1;null!==k.sourceId&&void 0!==k.sourceId?g.video.deviceId=k.sourceId:g.video=!1;f.exclude&&f.exclude.video?g.video=!1:f.exclude&&f.exclude.audio&&(g.audio=!1);e(g)})}};b.getUserMedia=function(a,b,d,f){c(a,b,d,f)};b.startDetecteMic=function(a){tknative.postMessage({command:"startDetecteMic",deviceId:a})};b.stopDetectMic=function(){tknative.postMessage({command:"stopDetecteMic"})};b.startDetecteCam=function(a,b){tknative.postMessage({command:"startDetecteCam",
deviceId:a,args:b})};b.stopDetecteCam=function(){tknative.postMessage({command:"stopDetecteCam"})};b.enumerateDevices=function(b,c){var d=f++;a[d]=b;b={};b.isSetlocalStorage=void 0===c?!1:void 0!=c.isSetlocalStorage?c.isSetlocalStorage:!1;g[d]=b;tknative.postMessage({command:"enumerateDevices",seq:d})};b.setSpeaker=function(a){tknative.postMessage({command:"setSpeaker",deviceId:a})};b.getsSoundMeterInstance=function(a){return new function(a){var b=this;b.audioContext=a;b.instant=0;b.slow=0;b.clip=
0;b.script=b.audioContext.createScriptProcessor(2048,1,1);b.script.onaudioprocess=function(a){a=a.inputBuffer.getChannelData(0);var c,d=0,e=0;for(c=0;c<a.length;++c)d+=a[c]*a[c],.99<Math.abs(a[c])&&(e+=1);b.instant=Math.sqrt(d/a.length);b.slow=.95*b.slow+.05*b.instant;b.clip=e/a.length};b.connectToSource=function(a,c){console.log("SoundMeter connecting");try{b.mic=b.audioContext.createMediaStreamSource(a),b.mic.connect(b.script),b.script.connect(b.audioContext.destination),"undefined"!==typeof c&&
c(null)}catch(m){console.error(m),"undefined"!==typeof c&&c(m)}};b.stop=function(){b.mic.disconnect();b.script.disconnect()};return b}(a)};b.setElementSinkIdToAudioouputDevice=function(a){a=localStorage.getItem(L.Constant.deviceStorage.audiooutput);tknative.postMessage({command:"setSpeaker",deviceId:a})};b.changeLocalDeviceToLocalstream=function(a,c,d,f){var e={},g;for(g in c)L.Constant.deviceStorage[g]&&c[g]!==localStorage.getItem(L.Constant.deviceStorage[g])&&(localStorage.setItem(L.Constant.deviceStorage[g],
c[g]),e[g]=!0);(e.videoinput||e.audioinput)&&b.getUserMedia(function(b){a&&"function"===typeof a&&a(b);d&&"function"===typeof d&&d(b)});f&&0<f.length&&b.setElementSinkIdToAudioouputDevice(f)};b.addOndevicechange=function(a){};b.removeOndevicechange=function(){};return b};
